---
output: md_document
---
# Solution for the Waffle-disaster project

Hey Edward, 

this is my solution so far, in the following one can see the plot with the simulated disaster zone:


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(rvest)
library(dplyr)
library(tidyr)
library(usmap)
library(tidyverse)

url <- "https://locations.wafflehouse.com" 

page <- read_html(url)
store_data <- 
  page |> 
  html_element("script#__NEXT_DATA__") |> 
  html_text() |> 
  jsonlite::fromJSON() |>
  purrr::pluck("props", "pageProps", "locations") |>
  unnest(addressLines) |>
  unnest(custom) |> 
  as_tibble()|>
  rename( Status = "_status") # rename, because name with underscore not accesible

# center of disaster zone, latitude and longitude
center <- list( lat = 36.31, long = -82.39 )
# radius for red zone
red_radius <- 2
# radius for yellow zone
yellow_radius <- 5


# plotting all points of the waffle houses in a custom map
waffle_map <- 
  store_data %>% 
mutate( Status = 
  if_else( (abs( latitude - center$lat ) < red_radius) & (abs( longitude - center$long ) < red_radius) ,
    "C", # in red range
      if_else( (abs( latitude - center$lat ) < yellow_radius) & (abs( longitude - center$long ) < yellow_radius),
    "CT",# in yellow range
    Status) # default: use old value
)) %>% 
  ggplot( aes(x = longitude, y = latitude,color=Status)) +
  geom_point(size = 1) +
  scale_color_manual(labels =c("green" , "red","yellow"),values = c("green" , "red","yellow")) +
  theme_minimal()+
  theme(axis.text = element_blank(),
  axis.title = element_blank(),
  panel.grid = element_blank(),
  legend.position = c(0, 0),
  legend.justification = c(0, 0))

# Plotting waffle-map on a US map
final_map <- plot_usmap(regions = "states", include = store_data$state) +
  labs(title = "Land of Plenty") + 
  # change xmin, etc.?
 # annotation_custom(ggplotGrob(waffle_map),xmin = min(store_data$latitude), xmax = max(store_data$latitude), ymin = min(store_data$longitude), ymax = max(store_data$longitude))
  annotation_custom(ggplotGrob(waffle_map))

final_map
```


Unfortunately, I assume that something with the plotting of the waffle house locations went wrong. It seems like they are shifted, but I could not figure out how to adjust it properly.
