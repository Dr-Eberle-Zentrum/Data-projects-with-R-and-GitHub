---
output: md_document
---
# Solution for the Waffle-disaster project

Hey Edward, 

this is my solution so far, in the following one can see the plot with the simulated disaster zone:


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(rvest)
library(dplyr)
library(tidyr)
library(usmap)
library(tidyverse)
library(sf)

url <- "https://locations.wafflehouse.com" 

page <- read_html(url)
store_data <- 
  page |> 
  html_element("script#__NEXT_DATA__") |> 
  html_text() |> 
  jsonlite::fromJSON() |>
  purrr::pluck("props", "pageProps", "locations") |>
  unnest(addressLines) |>
  unnest(custom) |> 
  as_tibble()|>
  rename( Status = "_status")|>
  rename(x=longitude,y=latitude) |> # rename, because name with underscore not accesible
  sf_transform_xy(target_crs = 2163, source_crs=4326)

# center of disaster zone, latitude and longitude
center <- list( lat = -1121903.4, long = 1409023.8)	
# radius for red zone
red_radius <- 100.0
# radius for yellow zone
yellow_radius <- 10000.0
 
#store data for simulated disaster
store_data_disaster <- store_data %>%
  mutate(Status =
           if_else(
             (abs(y - center$lat) < red_radius) &
               (abs(x - center$long) < red_radius) ,
             "C",
             # in red range
             if_else((abs(y - center$lat) < yellow_radius) &
                       (abs(x - center$long) < yellow_radius),
                     "CT", # in yellow range
                     Status))) # default: use old value
           
  
# Plotting waffle-map on a US map
final_map <-
  plot_usmap(regions = "states", include = store_data$state) +
  labs(title = "Land of Plenty") + 
  geom_point(data=store_data_disaster,mapping=aes(x = x, y = y,color=Status), size = 1) +
  scale_color_manual(labels =c("green" , "red","yellow"),values = c("green" , "red","yellow")) +
  theme_minimal()+
  theme(axis.text = element_blank(),
  axis.title = element_blank(),
  panel.grid = element_blank(),
  legend.position = c(0, 0),
  legend.justification = c(0, 0))

final_map
```


Unfortunately, I assume that something with the plotting of the waffle house locations went wrong. It seems like they are shifted, but I could not figure out how to adjust it properly.
