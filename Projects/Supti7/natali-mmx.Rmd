---
title: "natali-mmx"
output: md_document
---

```{r setup, include=FALSE}
library(tidyverse)
# install packages on first run:
# install.packages(c("sf", "rnaturalearth", "rnaturalearthdata", "viridis", "ggpubr"))
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(viridis)
library(ggpubr)
```

```{r dataImport, include = FALSE}
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
data <- read.csv("Salaries_data_scientists.csv")
```

```{r dataManipulation, include = FALSE}
data2024 <- data %>%
  filter(work_year == 2024)
# view(data2024)
```

# Remote Work Ratio by Country

We want to investigate the number of fully remote employees globally in 2024:

```{r jobNumbers, include = FALSE}
employeeLocations <- data2024 %>%
  filter(remote_ratio == 100) %>%
  group_by(employee_residence) %>%
  summarise(total_jobs = n()) %>%
  arrange(desc(total_jobs)) %>%
  rename(iso_a2 = employee_residence)
# view(employeeLocations)
```

```{r plotJobNumbers, echo = FALSE, warning=FALSE}
world <- ne_countries(scale = "medium", returnclass = "sf")

joinedData <- world %>%
  left_join(employeeLocations, by = "iso_a2")

ggplot(data = joinedData) +
  geom_sf(aes(fill = total_jobs), color = "white") +
  geom_sf_text(aes(label = total_jobs), size = 3, color = "black", na.rm = TRUE) +
  scale_fill_gradient(low = "lightsalmon", high = "lightskyblue", na.value = "grey90", name = "Total Jobs") +
  labs(title = "Total Number of Fully Remote Employees by Country",
       subtitle = "Data Scientists in 2024",
       caption = "Source: Salaries_data_scientists.csv") +
  theme_minimal() +
  theme(axis.title = element_blank(), legend.position = "bottom")

US <- employeeLocations %>%
  filter(iso_a2 == "US") %>%
  pull(total_jobs)

```

We can see that the USA has the highest number of fully remote jobs, followed by Canada and Great Britain, with a big gap between the USA and the rest of the countries. This indicates that the USA is the leading country with `r US` fully remote data science jobs in 2024.

# Salary Distribution in North America and Europe

Next, we visualize the salary distribution in North America and Europe for positions with a 100% remote work ratio. The data is grouped by experience level, with a particular focus on entry-level (EN) and mid-level (MI) roles.

```{r salaryDistribution, include = FALSE}
salaryDistribution <- data2024 %>%
  filter(remote_ratio == 100) %>%
  filter(experience_level %in% c("EN", "MI")) %>%
  group_by(company_location, experience_level) %>%
  select(experience_level, salary_in_usd, employee_residence)
# view(salaryDistribution)

countries <- unique(salaryDistribution$employee_residence)
# view(countries)
A <- c("US", "CA")
EU <- c("GB", "DE", "ES", "HR", "RO", "IE")

makeCountryList <- function(continentName, countryList) {
  paste0(continentName, ": ", paste(countryList, collapse = ", "))
}

salaryDistributionContinent <- salaryDistribution %>%
  mutate(continent = case_when(
    employee_residence %in% A ~ "North America",
    employee_residence %in% EU ~ "Europe",
    TRUE ~ "Other"
  )) %>% filter(continent != "Other")

counts <- salaryDistributionContinent %>%
  group_by(experience_level, continent) %>%
  summarise(n = n(), .groups = "drop")
```

```{r plotSalaryDistribution, echo = FALSE}
subtitleText <- paste(
  makeCountryList("Europe", EU),
  makeCountryList("North America", A),
  sep = " | "
)

ggplot(salaryDistributionContinent, aes(x = experience_level, y = salary_in_usd, fill = continent)) +
  geom_violin() +
  geom_text(data = counts, aes(x = experience_level, y = 0, label = n, group = continent),
            position = position_dodge(width = 0.9),
            vjust = 1.5, size = 3) +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_manual(values = c("Europe" = "lightsalmon", "North America" = "lightskyblue")) +
  annotate("text", x = 0.4, y = -20000, label = " n =", 
        hjust = 0, size = 3) +
  labs(title = "Salary Distribution by Continent and Experience Level",
       x = "Experience Level",
       y = "Salary (USD)",
       fill = "Continent", subtitle = subtitleText) +
  theme_minimal() +
  theme(legend.position = "bottom") +
  stat_compare_means(
    aes(group = continent),
    method = "wilcox.test",
    label = "p.format",
    label.y = c(250000, 250000, 250000, 250000),
    size = 4,
    ref.group = NULL
  )
```

We observe that the salary distribution for entry-level (EN) and mid-level (MI) positions in North America is significantly higher (p â‰¤ 0.05) than in Europe based on the Wilcoxon test. This indicates that data scientists in North America, particularly in the USA and Canada, tend to earn more than their European counterparts in comparable roles. However, it is important to note that the European dataset (n) is smaller, which may affect the reliability of these results.
