---
title: "janaelodie: Gulmiras project"
author: "janaelodie"
output: md_document
---

```{r setup, include= FALSE}
library(gridExtra)
library(tidyverse)
library(here)


data <- read_csv(here("Projects", "GulmiraKairr", "adult-depression.csv"), na = "NA")
```

## My solution to Gulmira´s project (first option)

```{r visualisation, echo= FALSE}

strata_categories <- unique(data$Strata)                # Liste der eindeutigen Werte in Strata
split_data <- lapply(strata_categories, function(cat) { # Datensätze nach Kategorie aufteilen
  cat <- as.character(cat)                              # Sicherstellen, dass cat eine Zeichenkette ist
  
  data %>%
    filter(Strata == cat) %>%                          # Filter nach Kategorie
    select(Year, `Strata Name`, Frequency, `Weighted Frequency`, Percent, `Lower 95% CL`, `Upper 95% CL`) %>%    # Relevante Spalten auswählen
    rename_with(~ ifelse(. == "Strata Name", cat, .)) # Spalte umbenennen
})

names(split_data) <- strata_categories                 # Datensätze benennen 


#### (3) Visualisierung

# Education level
education_plot <- ggplot(split_data$Education, aes(x = Year, y = Percent, color = Education, group = Education)) +
  geom_ribbon(aes(ymin = `Lower 95% CL`, ymax = `Upper 95% CL`, fill = Education), 
              alpha = 0.3, color = NA) +
  geom_line(size = 1) +
  geom_line(aes(y = `Lower 95% CL`), linetype = "dashed", size = 0.8) +
  geom_line(aes(y = `Upper 95% CL`), linetype = "dashed", size = 0.8) +
  labs(
    title = "Education level",
    x = "Year",
    y = "Annual Frequency",
    color = NULL,
    fill = NULL
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    legend.position = "bottom", 
    legend.key.size = unit(0.25, "cm"), 
    legend.key.width = unit(0.25, "cm"), 
    legend.text = element_text(size = 12) 
  ) +
  guides(
    color = guide_legend(ncol = 1),  # Vertikale Legende für Farben
    fill = guide_legend(ncol = 1),   # Vertikale Legende für Füllfarben
  )

### Race-Ethnicity
race_ethnicity_plot <- ggplot(split_data$`Race-Ethnicity`, aes(x = Year, y = Percent, color = `Race-Ethnicity`, group = `Race-Ethnicity`)) +
  geom_ribbon(aes(ymin = `Lower 95% CL`, ymax = `Upper 95% CL`, fill = `Race-Ethnicity`), 
              alpha = 0.3, color = NA) +
  geom_line(size = 1) +
  geom_line(aes(y = `Lower 95% CL`), linetype = "dashed", size = 0.8) +
  geom_line(aes(y = `Upper 95% CL`), linetype = "dashed", size = 0.8) +
  labs(
    title = "Race-Ethnicity",
    x = "Year",
    y = "Annual Frequency",
    color = NULL,
    fill = NULL
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    legend.position = "bottom",
    legend.key.size = unit( 0.25, "cm"), 
    legend.text = element_text(size = 12)
  ) +
  guides(
    color = guide_legend(ncol = 1),
    fill = guide_legend(ncol = 1)
  )
### Age
age_plot <- ggplot(split_data$Age, aes(x = Year, y = Percent, color = Age, group = Age)) +
  geom_ribbon(aes(ymin = `Lower 95% CL`, ymax = `Upper 95% CL`, fill = Age), 
              alpha = 0.3, color = NA) +
  geom_line(size = 1) +
  geom_line(aes(y = `Lower 95% CL`), linetype = "dashed", size = 0.8) +
  geom_line(aes(y = `Upper 95% CL`), linetype = "dashed", size = 0.8) +
  labs(
    title = "Age",
    x = "Year",
    y = "Annual Frequency",
    color = NULL,
    fill = NULL
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    legend.position = "bottom",
    legend.key.size = unit( 0.25, "cm"), 
    legend.text = element_text(size = 12),
  ) +
  guides(
    color = guide_legend(ncol = 1),
    fill = guide_legend(ncol = 1)
  )

grid.arrange(
  education_plot, race_ethnicity_plot, age_plot, 
  ncol = 3
)
```


## My solution to Gulmira´s project (second option)
```{r visualisation2, echo= FALSE}
data_clean <- data %>%
  filter(Strata %in% c("Education", "Race-Ethnicity", "Age")) %>% # Nur die relevanten Kategorien auswählen
  select(Year, Strata, `Strata Name`, Percent, `Lower 95% CL`, `Upper 95% CL`) %>% 
  rename(Category = Strata, Subcategory = `Strata Name`) # Einheitliche Spaltennamen

#### (3) Visualisierung mit Facetting ####
ggplot(data_clean, aes(x = Year, y = Percent, color = Subcategory, group = Subcategory)) +
  geom_ribbon(aes(ymin = `Lower 95% CL`, ymax = `Upper 95% CL`, fill = Subcategory), 
              alpha = 0.3, color = NA) +
  geom_line(size = 1) +
  geom_line(aes(y = `Lower 95% CL`), linetype = "dashed", size = 0.8) +
  geom_line(aes(y = `Upper 95% CL`), linetype = "dashed", size = 0.8) +
  labs(
    x = "Year",
    y = "Annual Frequency (%)",
    color = "Subcategory",
    fill = "Subcategory"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.title = element_text(size = 12),
    legend.position = "bottom",
    legend.key.size = unit(0.25, "cm"),
    legend.key.width = unit(0.25, "cm"),
    legend.text = element_text(size = 12)
  ) +
  guides(
    color = guide_legend(ncol = 1),  # Vertikale Legende
    fill = guide_legend(ncol = 1)
  ) +
  facet_wrap(~Category, ncol = 3, scales = "free_y")  # Eine Facette für jede Kategorie
```
