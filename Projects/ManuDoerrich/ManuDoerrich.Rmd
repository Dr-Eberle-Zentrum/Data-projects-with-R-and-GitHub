---
title: 'First project attempt - SunKyoungs project'
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(dplyr)
library(ggplot2)
library(gridExtra)
library(tidyr)
```
## General project topic

Companies often discover unique patterns when organizing and visualizing consumer data. This project aims to visualize shopping trends of American consumers by age group and gender, focusing on their Purchase Amount and Frequency of Purchases. You need to create four separate graphs:

  1. Female consumers’ purchase amount by age group,
  2. Male consumers’ purchase amount by age group,
  3. Female consumers’ frequency of purchases by age group,
  4. Male consumers’ frequency of purchases by age group.

## The Data Set (processed)
```{r import data}
# Define the URL of the raw csv file
url <- "https://raw.githubusercontent.com/OscarL7/Shopping-Trends-Analysis/main/shopping_trends_updated.csv"

# Import the csv file 
data_raw <- read.csv(url)

# Define AgeGroup labels
LabsAge <- c("18-22", "23-27", "28-32", "33-37", "38-42",
             "43-47", "48-52", "53-57", "58-62", "63-67",
             "68-70")

# Data processing
data_pro <- data_raw %>%
  # Select required/interesting columns from df data_raw
  select(all_of(c("Customer.ID", "Age", "Gender", "Purchase.Amount..USD.", "Frequency.of.Purchases"))) %>%
  # Calculate numeric frequency 
  mutate(`Frequency [1/year]` = case_when(
    Frequency.of.Purchases == "Annually" ~ 1,
    Frequency.of.Purchases == "Bi-Weekly" ~ 52/2,
    Frequency.of.Purchases == "Every 3 Months" ~ 4,
    Frequency.of.Purchases == "Fortnightly" ~ 52/2,
    Frequency.of.Purchases == "Monthly" ~ 12,
    Frequency.of.Purchases == "Quarterly" ~ 4,
    Frequency.of.Purchases == "Weekly" ~ 52,
    TRUE ~ 10000 # to show forgotten values instantly
  ),
  # factorise Age and Gender
  AgeGroup = factor(cut(Age, breaks = seq(18, 73, by = 5), right = FALSE),
                           labels = LabsAge),
  Gender = factor(Gender, levels = c("Male", "Female"))
  ) %>%
  # grouping 
  group_by(AgeGroup, Gender)

# Preview the data
head(data_pro)
```

## Visualisation

```{r visualisation (All_in_one), fig.width = 18, fig.height = 10}
data_pro %>%
  summarise(TotalPurchase = sum(Purchase.Amount..USD.),
            FreqPurchase = sum(`Frequency [1/year]`),
            .groups = 'drop') %>%
  pivot_longer(cols = c(TotalPurchase, FreqPurchase), names_to = "Metric", values_to = "Value") %>%
  ggplot(aes(x = AgeGroup, y = Value, fill = Gender)) +
  geom_bar(stat = "identity", position = "dodge") +
  geom_line(aes(group = Gender, colour = Gender), linewidth = 1.5, linetype = "solid") +
  labs(title = "Consumer Purchase Trends by age for two genders\n",
       x = "Age Group",
       y = NULL,
       fill = "Gender") +
  facet_wrap(~ Metric, scales = "free_y", labeller = as_labeller(c(
    TotalPurchase = "Total Purchase Amount\n[USD]",
    FreqPurchase = "Frequency of Purchase\n[1/year]"
  ))) +
  scale_x_discrete(labels = LabsAge) +
  theme_minimal() +
  theme(plot.title = element_text(face = "bold", size = 16, hjust = 0.5),
        axis.title = element_text(angle = 0, vjust = 0, size = 14),
        axis.text = element_text(size = 12),
        legend.title = element_text(face = "bold", size = 14),
        legend.text = element_text(size = 12),
        strip.text = element_text(size = 14, hjust = 0))

```