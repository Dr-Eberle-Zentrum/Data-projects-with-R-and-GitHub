
---
title: "Solution to Sarah's Project"
author: "Mohamed Elsherif"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output: md_document
---
```{r setup, include = F}
options(scipen=999)
```

***

```{r libraries}
library(tidyverse)
```


```{r data-import}
# Set the working directory to the location of the current script
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

# Load the dataset
dataset_fluency_features <- read.csv("dataset_fluency_features.csv", header = TRUE, stringsAsFactors = FALSE)

#' Data preprocessing as following: Remove duplicate rows
#' Filter dataset to include only specific columns
#' Strip any leading or trailing whitespace from articulationrate
#' Replace commas in zeros with periods in articulationrate
#' Convert articulationrate to numeric then
#' Drop any NAs
dataset_fluency_features_filtered <- dataset_fluency_features %>%
  distinct() %>%  # Remove duplicate rows
  select(articulationrate, npause, user_id, test_component_id) %>%  # Select specific columns
  mutate(
    articulationrate = articulationrate %>%
      trimws() %>%  # Remove leading and trailing whitespace
      gsub(",", ".", .) %>%  # Replace commas with periods
      as.numeric()  # Convert to numeric
  ) %>% 
  drop_na()  # Drop rows with any NA values


# Aggregate the dataset by user_id 
dataset_aggregated <- dataset_fluency_features_filtered %>%
  group_by(user_id, test_component_id) %>%
  summarise(
    mean_articulationrate = mean(articulationrate, na.rm = TRUE),
    mean_npause = mean(npause, na.rm = TRUE)
  )

# Load dataset 
dataset_total_score <- read.csv("dataset_total_score.csv", header = TRUE, stringsAsFactors = FALSE)

# Perform left join and remove NA values in a pipeline
merged_datasets <- dataset_aggregated %>%
  left_join(dataset_total_score, by = "user_id") %>%  # Perform left join
  na.omit()  # Drop rows with any NA values

# Check data structure of merged dataset
str(merged_datasets)

#################  Visualization #################
# Create scatterplot with facets one for each test component
scatterplot_faceted <- ggplot(merged_datasets, aes(x = mean_articulationrate, y = mean_npause, color = factor(test_component_id))) +
  geom_point() +
  labs(title = "Scatterplot",
       x = "Mean Articulation Rate",
       y = "Mean Npause",
       color = "Test Component ID") +
  theme_minimal() +
  facet_wrap(~ test_component_id, nrow = 1)

print(scatterplot_faceted)

# Create 2D density plot with filled faces and no color legend
density_plot_filled <- ggplot(dataset_aggregated, aes(x = mean_articulationrate, y = mean_npause, fill = factor(test_component_id))) +
  geom_density_2d() +
  labs(title = "2D Density Plot",
       x = "Mean Articulation Rate",
       y = "Mean Npause",
       fill = "Test Component ID") +
  theme_minimal() +
  guides(fill = FALSE)  # Remove fill legend

print(density_plot_filled)

########### Sarah's Recommendations #########

# Create scatterplot of Number of Pauses vs. Final Scores
scatterplot_npause <- ggplot(merged_datasets, aes(x = mean_npause, y = final_score)) +
  geom_point() +
  labs(title = "Scatterplot: Mean Npause vs. Final Scores",
       x = "Mean Number of Pauses",
       y = "Final Scores") +
  theme_minimal()

print(scatterplot_npause)

# Create scatterplot of Articulation Rate vs. Final Scores
scatterplot_articulation <- ggplot(merged_datasets, aes(x = mean_articulationrate, y = final_score)) +
  geom_point() +
  labs(title = "Scatterplot: Mean Articulation Rate vs. Final Scores",
       x = "Mean Articulation Rate",
       y = "Final Scores") +
  theme_minimal()

print(scatterplot_articulation)

# Create 2D density plot of Number of Pauses and Final Scores
density_plot_npause <- ggplot(merged_datasets, aes(x = mean_npause, y = final_score)) +
  geom_density_2d() +
  labs(title = "2D Density Plot: Mean Npause vs. Final Scores",
       x = "Mean Number of Pauses",
       y = "Final Scores") +
  theme_minimal()

print(density_plot_npause)

# Create 2D density plot of Articulation Rate and Final Scores
density_plot_articulation <- ggplot(merged_datasets, aes(x = mean_articulationrate, y = final_score)) +
  geom_density_2d() +
  labs(title = "2D Density Plot: Mean Articulation Rate vs. Final Scores",
       x = "Mean Articulation Rate",
       y = "Final Scores") +
  theme_minimal()

print(density_plot_articulation)
```
<div class="alert alert-block alert-info">
End of Solution
</div>




