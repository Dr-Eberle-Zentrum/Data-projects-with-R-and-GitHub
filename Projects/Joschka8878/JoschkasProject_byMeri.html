<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.56">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>joschkasproject_bymeri</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="JoschkasProject_byMeri_files/libs/clipboard/clipboard.min.js"></script>
<script src="JoschkasProject_byMeri_files/libs/quarto-html/quarto.js"></script>
<script src="JoschkasProject_byMeri_files/libs/quarto-html/popper.min.js"></script>
<script src="JoschkasProject_byMeri_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="JoschkasProject_byMeri_files/libs/quarto-html/anchor.min.js"></script>
<link href="JoschkasProject_byMeri_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="JoschkasProject_byMeri_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="JoschkasProject_byMeri_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="JoschkasProject_byMeri_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="JoschkasProject_byMeri_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<pre><code>library(tidyverse)
library(ggplot2)

# Set working directory
wd &lt;- rstudioapi::getSourceEditorContext()$path %&gt;%
dirname()
knitr::opts_knit$set(root.dir = wd)

# Load data
load("Data.RData")</code></pre>
<section id="eligibility-criteria" class="level2">
<h2 class="anchored" data-anchor-id="eligibility-criteria">Eligibility Criteria</h2>
<p>Here I am adding columns to the data indicating whether the Households are eligible for AUH Payments. The Criteria are based on:</p>
<ol type="1">
<li>Children under 18 living in that Household</li>
<li>Employment Status</li>
</ol>
<!-- -->
<pre><code>eligible &lt;- Data %&gt;% 
  group_by(Household) %&gt;% 
  mutate(Criterium_Child = if_else((any(Age &lt; 18)), "Yes", "No")) %&gt;% 
  filter(Age &gt;= 18) %&gt;% 
  mutate(Criterium_Origin = if_else(any(Country_Of_Birth == "Argentina"), "Non-Immigrant", "Immigrant"),
         Criterium_Employment = if_else(any(Employment_Position == "Unpaid Family Worker" |
                                              Individual_Income &gt; Min_Wage |
                                              Paid_Vacation == "No" |
                                              Bonus == "No" |
                                              Sick_Days == "No" |
                                              Health_Insurance == "No" |
                                              Pension_Discount == "No"),
                                        "Yes", "No")) %&gt;% 
  mutate(Criterium_AUH = if_else(any(Criterium_Child == "Yes" &amp; Criterium_Employment == "Yes"), "Yes", "No")) %&gt;% 
  ungroup()</code></pre>
</section>
<section id="visualization" class="level2">
<h2 class="anchored" data-anchor-id="visualization">Visualization</h2>
<p>First (a):</p>
<blockquote class="blockquote">
<p>the percentage of heads of households &amp; their spouses who are immigrants who are eligible for the AUH vs.&nbsp;the percentage of heads of Households &amp; their spouses who are non-immigrants and are eligible for the AUH</p>
</blockquote>
<p>Here I group my adjusted data set by Status (= Origin of Birth) and Eligibility, before summarising the percentage of each of the four groups (count of entries <code>n()</code> by total number of entries <code>n_households</code>), filtering for eligible households after that to only plot those. Plotting is just a basic ggplot boxplot with the Percentages as labels (using the <code>plyr::round_any</code> to round the percentages).</p>
<pre><code>eligible %&gt;% 
  filter(Family_Relationship == "Head of Household") %&gt;% 
  mutate(n_households = n()) %&gt;% 
  group_by(Criterium_Origin, Criterium_AUH) %&gt;% 
  reframe(Percentage = n()/n_households) %&gt;% 
  distinct() %&gt;% 
  filter(Criterium_AUH == "Yes") %&gt;% 
  ggplot(aes(x = as.factor(Criterium_Origin), y = Percentage))+
  geom_col(fill="#D38CA6")+
  geom_text(aes(label = plyr::round_any(Percentage, 0.0001, round)), nudge_y = 0.025)+
  theme_classic()+
  xlab("")+
  ylab("Percentage of HoH receiving AUH")+
  ggtitle("Percentage of Argentinian HoHs receiving AUH")</code></pre>
<p><img src="JoschkasProject_byMeri_files/figure-markdown_strict/a-1.png" class="img-fluid"></p>
<p>Second (b):</p>
<blockquote class="blockquote">
<p>the percentage of heads of households &amp; their spouses who are immigrants who are eligible for the AUH vs.&nbsp;the percentage of heads of households &amp; their spouses who are immigrants who are NOT eligible for the AUH</p>
</blockquote>
<pre><code>eligible %&gt;% 
  filter(Family_Relationship == "Head of Household") %&gt;% 
  filter(Criterium_Origin == "Immigrant") %&gt;% 
  drop_na() %&gt;% 
  mutate(n_households = n()) %&gt;%
  group_by(Criterium_AUH) %&gt;% 
  summarise(Percentage = n()/n_households) %&gt;% 
  distinct() %&gt;% 
  ungroup() %&gt;% 
  ggplot(aes(x = as.factor(Criterium_AUH), y = Percentage))+
  geom_col(fill="#D38CA6")+
  geom_text(aes(label = plyr::round_any(Percentage, 0.0001, round)), nudge_y = 0.025)+
  theme_classic()+
  xlab("")+
  ylab("Percentage of HoHs")+
  ggtitle("Eligibility of Immigrants for AUH")</code></pre>
<p><img src="JoschkasProject_byMeri_files/figure-markdown_strict/b-1.png" class="img-fluid"></p>
<p>And lastly onto (c):</p>
<blockquote class="blockquote">
<p>of all those who are eligible, what are the percentages based on age group (create age ranges), country of origin (within South America), province of origin (if born in Argentina), and education level.</p>
</blockquote>
<p>Starting with the age, where I cut the age into ranges before calculating the Percentage as usual.</p>
<pre><code>eligible %&gt;% 
  filter(Criterium_AUH == "Yes") %&gt;% 
  filter(Family_Relationship %in% c("Head of Household", "Spouse")) %&gt;%  
  drop_na() %&gt;% 
  mutate(Age_Range = cut(Age, c(0,20,30,40,50,60,70,80,90,Inf))) %&gt;%
  mutate(n_households = n()) %&gt;%
  group_by(Age_Range, Sex) %&gt;% 
  summarise(Percentage = n()/n_households) %&gt;% 
  distinct() %&gt;% 
  ungroup() %&gt;%
   ggplot(aes(fill = Sex, y=Percentage, x = Age_Range))+
  geom_bar(position = "stack", stat = "identity")+
  scale_fill_manual(values = c("#932322","#1D3A74"))+
  scale_x_discrete(labels = c("(0,20]" = "0-20",
                            "(20,30]" = "20-30",
                            "(30,40]" = "30-40",
                            "(40,50]" = "40-50",
                            "(50,60]" = "50-60",
                            "(60,70]" = "60-70",
                            "(70,80]" = "70-80",
                            "(80,90]" = "80-90",
                            "(90,Inf]" = "90 or older",
                            "NA" = "Not specified"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  xlab("Age Category")+
  ggtitle("Eligibilty by Age")</code></pre>
<p><img src="JoschkasProject_byMeri_files/figure-markdown_strict/c_age-1.png" class="img-fluid"></p>
<p>Next by country of Birth (if born outside of Argentia):</p>
<pre><code>eligible %&gt;% 
  filter(Criterium_AUH == "Yes") %&gt;% 
  mutate(n_households = n()) %&gt;% 
  filter(Criterium_Origin == "Immigrant") %&gt;% 
  group_by(Country_Of_Birth, Sex) %&gt;% 
  summarise(Percentage = n()/n_households) %&gt;% 
  distinct() %&gt;% 
  ungroup() %&gt;%
  ggplot(aes(fill = Sex, y=Percentage, x =Country_Of_Birth))+
  geom_bar(position = "stack", stat = "identity")+
  scale_fill_manual(values = c("#932322","#1D3A74"))+
  theme_classic()+ # Has to be called BEFORE the theme(axis.text)
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  xlab("Country of Birth")</code></pre>
<p><img src="JoschkasProject_byMeri_files/figure-markdown_strict/c_countryall-1.png" class="img-fluid"></p>
<p>Just South American Countries</p>
<pre><code>eligible %&gt;% 
  filter(Criterium_AUH == "Yes") %&gt;% 
  mutate(n_households = n()) %&gt;% 
  filter(Country_Of_Birth %in% c("BOLIVIA",
                                 "BRASIL",
                                 "CHILE",
                                 "COLOMBIA",
                                 "ECUADOR",
                                 "PERU",
                                 "PARAGUAY",
                                 "URUGUAY",
                                 "VENEZUELA")) %&gt;% 
  group_by(Country_Of_Birth, Sex) %&gt;% 
  summarise(Percentage = n()/n_households) %&gt;% 
  distinct() %&gt;% 
  ungroup() %&gt;%
  ggplot(aes(fill = Sex, y=Percentage, x =Country_Of_Birth))+
  geom_bar(position = "stack", stat = "identity")+
  scale_fill_manual(values = c("#932322","#1D3A74"))+
  theme_classic()+ # Has to be called BEFORE the theme(axis.text)
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  xlab("Country of Birth")</code></pre>
<p><img src="JoschkasProject_byMeri_files/figure-markdown_strict/c_countrsouthamerica-1.png" class="img-fluid"></p>
<p>Province of birth (if born in Argentina)</p>
<pre><code>eligible %&gt;% 
  filter(Criterium_AUH == "Yes") %&gt;% 
  mutate(n_households = n()) %&gt;% 
  filter(Country_Of_Birth == "Argentina") %&gt;% 
  group_by(Province_of_Birth, Sex) %&gt;% 
  summarise(Percentage = n()/n_households) %&gt;% 
  distinct() %&gt;% 
  ungroup() %&gt;%
  ggplot(aes(fill = Sex, y=Percentage, x = Province_of_Birth))+
  geom_bar(position = "stack", stat = "identity")+
  scale_fill_manual(values = c("#932322","#1D3A74"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  xlab("Province of Birth")</code></pre>
<p><img src="JoschkasProject_byMeri_files/figure-markdown_strict/c_province-1.png" class="img-fluid"></p>
<p>And last but not least Education level:</p>
<pre><code>eligible %&gt;% 
  filter(Criterium_AUH == "Yes") %&gt;% 
  mutate(n_households = n()) %&gt;% 
  group_by(Education_Level, Sex) %&gt;% 
  summarise(Percentage = n()/n_households) %&gt;% 
  distinct() %&gt;% 
  ungroup() %&gt;%
  ggplot(aes(fill = Sex, y=Percentage, x = Education_Level))+
  geom_bar(position = "stack", stat = "identity")+
  scale_fill_manual(values = c("#932322","#1D3A74"))+
  theme_classic()+
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  xlab("Level of Education")</code></pre>
<p><img src="JoschkasProject_byMeri_files/figure-markdown_strict/c_education-1.png" class="img-fluid"></p>
</section>
<section id="archived-old-solution" class="level2">
<h2 class="anchored" data-anchor-id="archived-old-solution">Archived Old Solution:</h2>
</section>
<section id="solution-to-joschkas-project-by-meri" class="level1">
<h1>Solution to Joschka’s Project by Meri</h1>
<p>So right now the data wrangling is still very messy, because I am splitting the Data set into “sub-datasets”. However I was unsure of how to perform the filtering in parallel on the data set (maybe using <code>if</code> / <code>ifelse</code>? I am just guessing here), so I’d love to get some feedback on that!</p>
<section id="data-filtering" class="level2">
<h2 class="anchored" data-anchor-id="data-filtering">Data filtering</h2>
<p>First I am loading the data and filtering on eligibility based on the employment criteria.</p>
<pre><code># # Load data from RData file
# load("~/Desktop/R2_DataProjects/R2_Data_Projects_Git/Projects/Joschka8878/Data.RData")
# 
# # Filtering for eligibility
# # There is probably a better way to do this (e.g. filtering in one step) but this also works
# eligible &lt;- Data %&gt;% 
#   group_by(Household) %&gt;% 
#   filter(any(Age &lt; 18))    # Child under 18
# 
# # Unemployed
# eliunemployed &lt;- eligible %&gt;% 
#   filter(any(Unemployed == 1)) %&gt;% 
#   ungroup()
# 
# # Informal workers
# elidom &lt;- eligible %&gt;% 
#   filter(any(Employment_Position %in% c("Unpaid Family Worker"))) %&gt;% 
#   ungroup()
# 
# eliinf &lt;- eligible %&gt;% 
#   filter_at(vars(Paid_Vacation, Bonus, Sick_Days, Health_Insurance, Pension_Discount), any_vars(. =="No"))
# 
# # Earning less than minium wage
# elimin &lt;- eligible %&gt;% 
#   filter(any(Individual_Income &lt; Min_Wage)) %&gt;% 
#   ungroup()
# 
# # Combining all into one dataframe
# eligibleall &lt;- rbind(eliunemployed, elidom, elimin, eliinf) %&gt;% 
#   distinct()</code></pre>
<p>Next I am filtering for Eligible/ Non-Eligible Households and their origin (Argentina or Abroad).</p>
<pre><code># # Eligible + Born in Argentina
# non_im_eg &lt;- eligibleall %&gt;% 
#   filter(Family_Relationship %in% c("Head of Household", "Spouse")) %&gt;% 
#   filter(Country_Of_Birth == "Argentina") %&gt;% 
#   mutate(Status = "Born in Argentina") %&gt;% 
#   mutate(Eligible = "Eligible")
# 
# # Not Eligible + Born in Argentina
# non_im_non &lt;- Data %&gt;% 
#   filter(Family_Relationship %in% c("Head of Household", "Spouse")) %&gt;% 
#   filter(Country_Of_Birth == "Argentina") %&gt;% 
#   mutate(Status = "Born in Argentina") %&gt;% 
#   mutate(Eligible = "Not Eligible")
# non_im_non[!(non_im_non$Household %in% non_im_eg$Household),]
# 
# # Eligible + Born Abroad
# im_eg &lt;- eligibleall %&gt;% 
#   filter(Age &gt; 18) %&gt;% 
#   filter(Family_Relationship == c("Head of Household", "Spouse")) %&gt;% 
#   filter(Country_Of_Birth != "Argentina") %&gt;% 
#   mutate(Status = "Born Abroad")%&gt;% 
#   mutate(Eligible = "Eligible")
# 
# # Not Eligible + Born Abroad
# im_non &lt;- Data %&gt;% 
#   filter(Family_Relationship == c("Head of Household", "Spouse")) %&gt;% 
#   filter(Country_Of_Birth == "Argentina") %&gt;% 
#   mutate(Status = "Born Abroad") %&gt;% 
#   mutate(Eligible = "Not Eligible")
# im_non &lt;- im_non[!(im_non$Household %in% im_eg$Household),]
# 
# # Combining all into one dataframe
# data_im &lt;- rbind(non_im_eg, im_eg, non_im_non, im_non)</code></pre>
</section>
<section id="visualization-1" class="level2">
<h2 class="anchored" data-anchor-id="visualization-1">Visualization</h2>
<p>First (a):</p>
<blockquote class="blockquote">
<p>the percentage of heads of households &amp; their spouses who are immigrants who are eligible for the AUH vs.&nbsp;the percentage of heads of Households &amp; their spouses who are non-immigrants and are eligible for the AUH</p>
</blockquote>
<p>Here I group my adjusted data set by Status (= Origin of Birth) and Eligibility, before summarising the percentage of each of the four groups (count of entries <code>n()</code> by total number of entries <code>length(data_im$Household)</code>), filtering for eligible households after that to only plot those. Plotting is just a basic ggplot boxplot with the Percentages as labels (using the <code>plyr::round_any</code> to round the percentages).</p>
<pre><code># data_im %&gt;% 
#   group_by(Status, Eligible) %&gt;% 
#   summarise(Percentage = n()/length(data_im$Household)) %&gt;% 
#   filter(Eligible == "Eligible") %&gt;% 
#   ungroup() %&gt;% 
#   ggplot(aes(x = as.factor(Status), y = Percentage))+
#   geom_col(fill="#26466C")+
#   geom_text(aes(label = plyr::round_any(Percentage, 0.0001, round)), nudge_y = 0.025)+
#   theme_classic()+
#   xlab("")+
#   ylab("Percentage of HoH receiving AUH")+
#   ggtitle("Percentage of Argentinian HoHs receiving AUH")</code></pre>
<p>Second (b):</p>
<blockquote class="blockquote">
<p>the percentage of heads of households &amp; their spouses who are immigrants who are eligible for the AUH vs.&nbsp;the percentage of heads of households &amp; their spouses who are immigrants who are NOT eligible for the AUH</p>
</blockquote>
<p>Basically I tackled this the same way as (a) only creating another dataframe (yikes, I know…) to have the correct length/ number of entries for the Percentage. Probably a better way to do that using only the original dataframe, but I did not have the time to get around to do that (Sorry!).</p>
<pre><code># data_imonly &lt;- rbind(im_eg, im_non)
# 
# data_imonly %&gt;% 
#   group_by(Eligible) %&gt;% 
#   summarise(Percentage = n()/length(data_imonly$Household)) %&gt;% 
#   ungroup() %&gt;% 
#   ggplot(aes(x = as.factor(Eligible), y = Percentage))+
#   geom_col(fill="#26466C")+
#   geom_text(aes(label = plyr::round_any(Percentage, 0.0001, round)), nudge_y = 0.025)+
#   theme_classic()+
#   xlab("")+
#   ylab("Percentage of HoHs")+
#   ggtitle("Eligibility of Immigrants for AUH")
#   </code></pre>
<p>And lastly onto (c):</p>
<blockquote class="blockquote">
<p>of all those who are eligible, what are the percentages based on age group (create age ranges), country of origin (within South America), province of origin (if born in Argentina), and education level.</p>
</blockquote>
<p>Starting with the age, where I cut the age into ranges before calculating the Percentage as usual.</p>
<pre><code># eligibleall %&gt;% 
#   mutate(Age_Range = cut(Age, c(0,20,30,40,50,60,70,80,90,Inf))) %&gt;% 
#   group_by(Age_Range, Sex) %&gt;% 
#   summarise(Percentage = n()/length(data_im$Household)) %&gt;% 
#   ungroup() %&gt;%
#   ggplot(aes(fill = Sex, y=Percentage, x = Age_Range))+
#   geom_bar(position = "stack", stat = "identity")+
#   scale_fill_manual(values = c("#932322","#1D3A74"))+
#   scale_x_discrete(labels = c("(0,20]" = "0-20",
#                             "(20,30]" = "20-30",
#                             "(30,40]" = "30-40",
#                             "(40,50]" = "40-50",
#                             "(50,60]" = "50-60",
#                             "(60,70]" = "60-70",
#                             "(70,80]" = "70-80",
#                             "(80,90]" = "80-90",
#                             "(90,Inf]" = "90 or older",
#                             "NA" = "Not specified"))+
#   theme_classic()+
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
#   xlab("Age Category")+
#   ggtitle("Eligibilty by Age")</code></pre>
<p>Next by country of Birth (if born outside of Argentia):</p>
<pre><code># eligibleall %&gt;% 
#   filter(Country_Of_Birth != "Argentina") %&gt;% 
#   group_by(Country_Of_Birth, Sex) %&gt;% 
#   summarise(Percentage = n()/length(eligibleall$Household)) %&gt;% 
#   ungroup() %&gt;%
#   ggplot(aes(fill = Sex, y=Percentage, x =Country_Of_Birth))+
#   geom_bar(position = "stack", stat = "identity")+
#   scale_fill_manual(values = c("#932322","#1D3A74"))+
#   theme_classic()+ # Has to be called BEFORE the theme(axis.text)
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
#   xlab("Country of Birth")</code></pre>
<p>Just South American Countries</p>
<pre><code># eligibleall %&gt;% 
#   filter(Country_Of_Birth %in% c("BOLIVIA",
#                                  "BRASIL",
#                                  "CHILE",
#                                  "COLOMBIA",
#                                  "ECUADOR",
#                                  "PERU",
#                                  "PARAGUAY",
#                                  "URUGUAY",
#                                  "VENEZUELA")) %&gt;% 
#   group_by(Country_Of_Birth, Sex) %&gt;% 
#   summarise(Percentage = n()/length(eligibleall$Household)) %&gt;% 
#   ungroup() %&gt;%
#   ggplot(aes(fill = Sex, y=Percentage, x =Country_Of_Birth))+
#   geom_bar(position = "stack", stat = "identity")+
#   scale_fill_manual(values = c("#932322","#1D3A74"))+
#   theme_classic()+ # Has to be called BEFORE the theme(axis.text)
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
#   xlab("Country of Birth")</code></pre>
<p>Province of birth (if born in Argentina)</p>
<pre><code># eligibleall %&gt;% 
#   filter(Country_Of_Birth == "Argentina") %&gt;% 
#   group_by(Province_of_Birth, Sex) %&gt;% 
#   summarise(Percentage = n()/length(data_im$Household)) %&gt;% 
#   ungroup() %&gt;%
#   ggplot(aes(fill = Sex, y=Percentage, x = Province_of_Birth))+
#   geom_bar(position = "stack", stat = "identity")+
#   scale_fill_manual(values = c("#932322","#1D3A74"))+
#   theme_classic()+
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
#   xlab("Province of Birth")</code></pre>
<p>And last but not least Education level:</p>
<pre><code># eligibleall %&gt;% 
#   group_by(Education_Level, Sex) %&gt;% 
#   summarise(Percentage = n()/length(data_im$Household)) %&gt;% 
#   ungroup() %&gt;%
#   ggplot(aes(fill = Sex, y=Percentage, x = Education_Level))+
#   geom_bar(position = "stack", stat = "identity")+
#   scale_fill_manual(values = c("#932322","#1D3A74"))+
#   theme_classic()+
#   theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
#   xlab("Level of Education")</code></pre>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>