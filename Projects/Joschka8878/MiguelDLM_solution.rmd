---
title: "MiguelDLM's solution to Joschka8878's project"
author: "Miguel Díaz de León"    
output: md_document
---

## Load the data

First let's load the data.

```{r load-data}
#set the working directory to the folder where this file is located
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))

# Load the data from the RData file that is in the same folder as this Rmd file
load(paste0(getwd(), "/EPH_DATA.RData"))

#count the number of rows
nrow(EPH_DATA)
```

## Explorig the data

Let's explore the data a bit.

```{r explore-data}
# Summary of the data
summary(EPH_DATA)

# Variable names
names(EPH_DATA)
#number of rows
nrow(EPH_DATA)
```

The original dataset cointains 235,332 records and 198 variables, not all of them are relevant for the analysis. Let's filter the data to include only the relevant variables.
According to the document "Diseño de Registro y Estructura para las bases  preliminares Hogar y Personas" (design of the register and structure for the preliminary household and person databases), the variable "NRO_HOGAR" is the household identifier, the Variable CH03 define the role of the person in the household and the variable CH06 is the age of the person. We first need to filter the data to include only the people that are the head of the household and kids under 18 years old.

```{r filter-data}
#Count the number of kids under 18 years old
sum(EPH_DATA$CH06 < 18)
# Filter the data to include only the head of the household and kids under 18 years old
EPH_DATA <- EPH_DATA[EPH_DATA$CH03 == 1 | EPH_DATA$CH06 < 18, ]
#number of rows
nrow(EPH_DATA)
```
We have now 139,451, however, not all households have kids under 18 years old. Lets now filter the data again to include only houses with kids under 18 years old.

```{r filter-data2}
# Filter the data to include only houses with kids under 18 years old
EPH_DATA <- EPH_DATA[EPH_DATA$NRO_HOGAR %in% EPH_DATA[EPH_DATA$CH06 < 18, ]$NRO_HOGAR, ]
#number of rows
nrow(EPH_DATA)
```

We have now 139,451 records.
Now lets separate the people that was born in Argentina from the people that was born in other countries to compare the chances to apply for the program.
According to the same document, the variable "CH15" is the country of birth of the person.

The options 1, 2 and 3 correspond to Argentina, so we will filter the data to include only the people that was born in Argentina. The options 4,5 and 9 are for foreign countries. Let's add a new column to indicate the origin of the person.

```{r add-origin-variable}
# Add a new column to indicate the origin of the person
EPH_DATA$Origen <- ifelse(EPH_DATA$CH15 %in% c(1,2,3), 'Argentina', 'Extranjero')
#count the number of people by origin
table(EPH_DATA$Origen)

```


```{r count-households-combined}
# Count the number of unique households by origin
conteos_unicos <- EPH_DATA %>%
    group_by(Origen) %>%
    summarise(Count = n_distinct(CODUSU))

# Create a bar plot
ggplot(data = conteos_unicos, aes(x = Origen, y = Count, fill = Origen)) +
    geom_col() +
    labs(title = "Number of unique households by origin",
             x = "Origin",
             y = "Number of unique households") +
    scale_fill_manual(values = c("Argentina" = "blue", "Extranjero" = "red")) +
    theme_minimal()
```
This plot shows the number of households were at least one person under 18 lives by origin of the people. If we want to compare the chances of applying for the program between households with people born in Argentina and households with people born in other countries, we need to consider additional filters to make the comparison more accurate. For example, we could filter the data to include only households with kids under 18 years old and with a monthly income below a certain threshold.

The avobe code can be simplified by using the `dplyr` package for applying the filters and summarizing the data. The following code shows how to do this.

```{r count-households-dplyr}
library(dplyr)
library(ggplot2)

EPH_DATA %>%
    filter(CH03 == 1 | CH06 < 18) %>%
    filter(NRO_HOGAR %in% .$NRO_HOGAR[CH06 < 18]) %>%
    mutate(Origen = ifelse(CH15 %in% c(1, 2, 3), 'Argentina', 'Extranjero')) %>%
    count(Origen) %>%
    ggplot(aes(x = Origen, y = n, fill = Origen)) +
        geom_col() +
        labs(title = "Number of unique households by origin",
                 x = "Origin",
                 y = "Number of unique households") +
        scale_fill_manual(values = c("Argentina" = "blue", "Extranjero" = "red")) +
        theme_minimal()
```