---
title: "MiguelDLM's solution to Joschka8878's project"
author: "Miguel Díaz de León"    
output: md_document
---

## Load the data

First let's load the data.

```{r load-data}
library(here)
library(tidyverse)

# Navigate to a subdirectory within your project
setwd(here::here("Projects/Joschka8878"))
# Load the data from the RData file located in the same folder as this Rmd file
load("Data.RData")

Data$Country_Group <- ifelse(Data$Country_Of_Birth == "Argentina", "Argentina", "Other")

# Remove duplicates and keep the unique rows for each individual
Data_original <- Data %>%
    distinct(Individual, .keep_all = TRUE) %>%
    select(Household, everything()) %>%
    filter(Family_Relationship == "Head of Household") 


```

## Explorig the data

Let's explore the data a bit.

```{r explore-data}
# Summary of the data
summary(Data)

# Variable names
names(Data)
#number of rows
nrow(Data)

```

## Data Cleaning

We will create a new data frame with the columns we need for the analysis. 

```{r data-cleaning}
Data <- Data %>%
    distinct(Individual, .keep_all = TRUE) %>%
    select(Household, everything()) %>%
    filter(Family_Relationship == "Head of Household") %>%
    left_join(Data %>%
                            filter(Family_Relationship %in% c("Child/stepchild", "Grandchild")) %>%
                            group_by(Household) %>%
                            summarise(Number_of_Children = n()),
                        by = "Household") %>%
    filter(!is.na(Number_of_Children)) %>%
    filter(Unemployed == 1)

```
We removed duplicates and selected only the head of the household. We then joined the data with the number of children in the household. Then, we removed the households without children. Finally, we filtered the households where the head of the household is unemployed.

## Data Analysis

We may compare the number of individual in the Data frame and the Data_original frame. This will let us know how many of the total individuals (Data_original) are elegible for the AUH program (Data).

```{r data-analysis1}

library(dplyr)
library(ggplot2)

total_individuals <- nrow(Data_original)

eligible_individuals <- nrow(Data)

non_eligible_individuals <- total_individuals - eligible_individuals

summary_df <- data.frame(
    Category = c("Non-Eligible for AUH", "Eligible for AUH"),
    Count = c(non_eligible_individuals, eligible_individuals),
    Percentage = c(non_eligible_individuals / total_individuals, eligible_individuals / total_individuals)
)

ggplot(summary_df, aes(x = Category, y = Count, fill = Category)) +
  geom_bar(stat = "identity", alpha = 0.5) +
  geom_text(aes(label = scales::percent(Percentage)), vjust = -0.5) +
  theme_minimal() +
  labs(title = "Number of individuals eligible for AUH",
      x = "Eligibility",
      y = "Number of individuals") +
  scale_fill_manual(values = c("Non-Eligible for AUH" = "blue", "Eligible for AUH" = "red")) +
  scale_x_discrete(labels = c("Non-Eligible for AUH", "Eligible for AUH"))+ 
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          panel.background = element_blank(), axis.line = element_line(colour = "black"))
```

From the total number of households (Data_original), we can see that only 2% of the individuals are eligible for the AUH program because they are unemployed and have children.

## Analyze the elegible households by criteria

First, we will count the number of households by country of birth.

```{r data-analysis}
conteos <- Data %>%
    count(Country_Of_Birth) %>%
    arrange((n))

Data$Country_Of_Birth <- factor(Data$Country_Of_Birth, levels = conteos$Country_Of_Birth)

ggplot(Data, aes(x = Country_Of_Birth, fill = Country_Group)) +
    geom_bar() +
    coord_flip() + 
    theme_minimal() +
    labs(title = "Number of households by country of birth",
        x = "Country of Birth",
        y = "Number of households") +
    scale_fill_manual(values = c("Argentina" = "blue", "Other" = "red"))+ 
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          panel.background = element_blank(), axis.line = element_line(colour = "black"))

```

Instead of plotting the number of households by country of birth, we may compare if the household is from Argentina or not.

```{r data-analysis2}

ggplot(Data, aes(x = Country_Group, fill = Country_Group)) +
    geom_bar() +
    theme_minimal() +
    labs(title = "Number of households by country of birth",
        x = "Country of Birth",
        y = "Number of households") +
    scale_fill_manual(values = c("Argentina" = "blue", "Other" = "red"))+
    #add the percentage of households in each category
    geom_text(aes(label = scales::percent((..count..)/sum(..count..))), stat = "count", vjust = -0.5) + 
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          panel.background = element_blank(), axis.line = element_line(colour = "black"))

```

We may compare the number of households by age and nationality.

```{r data-analysis3}

Data$Age_Group <- cut(Data$Age, breaks = c(0, 18, 30, 40, 50, 60, 70, 80, 90, 100), labels = c("0-18", "19-30", "31-40", "41-50", "51-60", "61-70", "71-80", "81-90", "91-100"))

ggplot(Data, aes(x = Age_Group, fill = Country_Group)) +
    geom_bar() +
    theme_minimal() +
    labs(title = "Number of households by age group",
        x = "Age Group",
        y = "Number of households") +
    scale_fill_manual(values = c("Argentina" = "blue", "Other" = "red"))+ 
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          panel.background = element_blank(), axis.line = element_line(colour = "black"))
    
```

We may compare the number of households by age and sex.

```{r data-analysis4}

ggplot(Data, aes(x = Age_Group, fill= Sex)) +
    geom_bar() +
    theme_minimal() +
    labs(title = "Number of households  by age group",
        x = "Age Group",
        y = "Number of households") +
    scale_fill_manual(values= c("Male" = "blue", "Female" = "red")) + 
    theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
          panel.background = element_blank(), axis.line = element_line(colour = "black"))

```