---
title: "Sleep and Mood Dynamics: A Longitudinal Analysis"
author: "Research Project"
date: "`r Sys.Date()`"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

# Project Overview

Sleep is fundamental to physical health, cognitive function, and emotional wellbeing. Despite widespread recognition of sleep's importance, the precise temporal dynamics linking daily sleep patterns to affective states and depressive symptoms remain incompletely understood. While cross-sectional studies have established associations between sleep disturbance and mood disorders, longitudinal intensive measurement approaches are needed to disentangle cause from consequence and identify the timescales over which these relationships unfold.

This project examines the bidirectional relationships between sleep patterns, daily mood fluctuations, and depressive symptoms using intensive longitudinal data collected over approximately 19 months. By leveraging daily sleep monitoring alongside planned assessments of affect and depression screening, we study the temporal precedence and dynamic influences among these key health indicators. Understanding these relationships has implications for both prevention (identifying early warning signs) and intervention (optimizing timing and targets of treatment).

# Research Questions and Hypotheses

## Hypothesis 1: Acute Sleep-Mood Relationship

**Main hypothesis**: Reduced nocturnal sleep duration on day *t* predicts lower positive affect and higher negative affect on day *t+1*, controlling for day *t* mood (autoregressive effects).

**Research question**: What is the magnitude of the lagged effect of nocturnal sleep duration on next-day positive and negative affect in the early postpartum period?

## Hypothesis 2: Cumulative Sleep Patterns and Depression Development

**H2a**: Lower mean sleep duration across 2-week blocks (weeks 1-2, 3-4, 5-6) predicts higher BDI scores, with effects strengthening over time (test interaction: time × sleep duration).

**H2b**: Greater sleep irregularity (standard deviation or coefficient of variation of sleep duration within each 2-week block) predicts higher BDI scores beyond mean duration effects.

**H2c**: The predictive value of sleep deprivation on BDI increases over time (test: week × sleep interaction), reflecting cumulative burden.

**H2d**: Daytime sleep partially compensates for nocturnal sleep loss in predicting BDI (test: total 24-hour sleep vs. nocturnal-only sleep models; interaction between day and night sleep).

# Dataset Description

Here is the data folder: [Open data folder](/Week4%20Homework-%20Sleep%20synthetic%20project)

## Data Source and Structure

The dataset consists of sleep monitoring data collected via a wearable device throughout an extended period. The data spans from February 7, 2024 through September 8, 2025, providing nearly continuous daily sleep recordings across approximately 19 months.

Second and third dataset contains PANAS (Positive and negative affect schedule) daily mood ratings and BDI (Beck Depression Inventory) scores at multiple postpartum timepoints, but these are available in another files and have to be combined.

Participants names differ in the sleep annd PANAS+BDI files, they are named in the following way:

| BDI + Panas subject ID | Sleep data subject ID |
|------------------------|-----------------------|
| SUBJ1                  | 7G8F                  |
| SUBJ2                  | 15JL                  |
| SUBJ3                  | ELJT                  |
| SUBJ4                  | FYKQ                  |
| SUBJ5                  | HT2J                  |
| SUBJ6                  | PBL7                  |
| SUBJ7                  | S7YA                  |
| SUBJ8                  | WONX                  |
| SUBJ9                  | YB6F                  |
| SUBJ10                 | JS27                  |

## Data Format

### Sleep Data

The dataset is provided as CSV files with the following structure:

```{r preview-sleep-data, echo=FALSE}
# Show first few lines of the sleep data structure
cat('von,bis,"leicht (s)","tief (s)","rem (s)","wach (s)",Aufwachen,"Dauer des Schlafs (s)","Dauer bis zum Wachwerden (s)","Schnarchen (s)",Schnarchepisoden,"Durchschnittliche Herzfrequenz","Herzfrequenz (min)","Herzfrequenz (max)","Night events"
2024-02-07T00:15:00+01:00,2024-02-07T08:05:00+01:00,6120,21960,0,120,0,120,0,0,0,54,50,64,
2024-02-08T00:09:00+01:00,2024-02-08T08:01:00+01:00,20400,7800,0,120,0,120,0,0,0,52,48,65,')
```

### PANAS Data

The second dataset contains daily mood ratings with the following structure:

```{r preview-panas-data, echo=FALSE}
# Show structure of PANAS data
cat('participant,date,PANAS_positive,PANAS_negative
P001,2024-02-07,28,15
P001,2024-02-08,32,12')
```

**Columns**: - `participant`: Participant identifier - `date`: Assessment date (YYYY-MM-DD format) - `PANAS_positive`: Positive Affect score (range: 10-50) - `PANAS_negative`: Negative Affect score (range: 10-50)

### BDI Data

The third dataset contains depression screening scores:

```{r preview-bdi-data, echo=FALSE}
# Show structure of BDI data
cat('participant,date,BDI_score
P001,2024-02-14,8
P001,2024-02-28,6')
```

**Columns**: - `participant`: Participant identifier - `date`: Assessment date (YYYY-MM-DD format) - `BDI_score`: Beck Depression Inventory total score (range: 0-63)

Variable Definitions

The dataset contains German-language column headers with the following English translations and descriptions:

| German Column Name | English Translation | Description | Units |
|------------------|------------------|------------------|------------------|
| von | from | Sleep period start timestamp | ISO 8601 datetime |
| bis | to | Sleep period end timestamp | ISO 8601 datetime |
| leicht (s) | light (s) | Light sleep duration | seconds |
| tief (s) | deep (s) | Deep sleep duration | seconds |
| rem (s) | rem (s) | REM sleep duration | seconds |
| wach (s) | awake (s) | Time awake during sleep period | seconds |
| Aufwachen | Awakenings | Number of awakenings | count |
| Dauer des Schlafs (s) | Sleep duration (s) | Total sleep period duration | seconds |
| Dauer bis zum Wachwerden (s) | Duration until waking (s) | Time until final awakening | seconds |
| Schnarchen (s) | Snoring (s) | Snoring duration | seconds |
| Schnarchepisoden | Snoring episodes | Number of snoring episodes | count |
| Durchschnittliche Herzfrequenz | Average heart rate | Mean HR during sleep | bpm |
| Herzfrequenz (min) | Heart rate (min) | Minimum HR during sleep | bpm |
| Herzfrequenz (max) | Heart rate (max) | Maximum HR during sleep | bpm |
| Night events | Night events | Recorded nocturnal events | text |

# Data Manipulation Goals

## 1. Data Cleaning and Validation

**Tasks**:

-   Parse and validate datetime formats
-   Identify and resolve duplicate date entries
-   Flag physiologically implausible values (e.g., total sleep \> 16 hours, heart rate \< 30 or \> 200 bpm)
-   Assess and document missingness patterns for REM sleep and heart rate
-   Create data quality flags for each observation

**Rationale**: Sleep data from wearable devices often contain artifacts, and multiple entries per date suggest data streaming or synchronization issues that require resolution.

## 2. Feature Engineering

**Core sleep variables**:

-   **Total sleep duration**: `light + deep + rem` (in hours)
-   **Number of sleep events**: number of entries from each night
-   **Sleep regularity/variability**

**Temporal variables**:

-   **Date**: Extract date from "von" timestamp
-   **Day of week**: For testing weekly periodicity
-   **Study day**: Sequential numbering (requires known delivery date or study start)
-   **Week**: Grouped into 2-week blocks for H2 analyses

**Derived sleep metrics** (for H2):

-   **14-day rolling means**: Sleep duration, efficiency, deep sleep percentage
-   **14-day rolling SD**: Sleep duration variability
-   **Coefficient of variation**: SD/mean for each 2-week window
-   **Sleep debt accumulation**: Cumulative deviation from 7-hour baseline

## 3. Data Aggregation Strategies

**For duplicate date entries**:

-   **Primary approach**: Select the longest sleep period for each date (assuming this represents the main nocturnal sleep bout)
-   **Alternative approach**: Sum all sleep periods per 24-hour window (but complicates temporal alignment)
-   **Document**: Create flag variable indicating dates with multiple entries

## 4. Data Validation Checks

**Consistency checks**:

-   Verify `sleep duration` ≈ `light + deep + rem + awake`

-   Confirm timestamps logical (bis \> von)

-   Check sleep period duration matches timestamp difference

-   Identify outliers: sleep duration \< 3 hours or \> 12 hours, sleep efficiency \< 60% or \> 98%

-   Flag sequences with \>3 consecutive missing days

-   Assess whether missing patterns correlate with time periods (e.g., device charging, hospital visits)

**Physiological plausibility**:

-   Heart rate should remain within 40-100 bpm range during sleep for healthy adults

# Visualization Goals

## Primary Visualizations

**1. Sleep Architecture Over Time** (Longitudinal Overview)

-   **Type**: Stacked area chart or ribbon plot
-   **X-axis**: Date (full study period)
-   **Y-axis**: Sleep duration (hours)
-   **Overlay**: Smoothed trend line (LOESS or moving average)
-   **Purpose**: Visualize sleep stage composition evolution, identify periods of disruption

**2. Sleep Metrics by Study Week** (Hypothesis 2 foundation)

-   **Type**: Multi-panel line plot with confidence ribbons
-   **Panels**:
    -   Mean sleep duration with SD bands
-   Sleep efficiency percentage
-   Awakening frequency
-   **X-axis**: Study week or date?
-   **Y-axis**: Respective metric (hours/minutes?)
-   **Purpose**: Show temporal trends and variability patterns relevant to H2

**3. Sleep Duration Distribution** (Variability assessment)

-   **Type**: Violin plot or density ridges by 2-week blocks
-   **X-axis**: Sleep duration (hours)
-   **Y-axis**: Density, grouped by 2-week periods
-   **Purpose**: Assess sleep regularity (H2b) and identify high-variability periods

**4. Circadian Pattern Visualization** (Exploratory)

-   **Type**: Circular histogram or rose diagram
-   **Dimension**: Sleep onset time (hour of day)
-   **Color**: Total sleep duration
-   **Facets**: By month or 4-week blocks
-   **Purpose**: Detect circadian stability, common in postpartum literature

## Intermediate/Supporting Visualizations

**5. Data Quality Dashboard**

-   **Type**: Multi-panel diagnostic plot
-   **Panels**:
    -   Missingness heatmap (dates × variables)
-   Outlier detection scatterplots (Mahalanobis distance or isolation forest)
-   Distribution histograms for key variables
-   **Purpose**: Document data cleaning decisions, support transparency
-   

**6. Summary Statistics Table**

-   **Type**: Formatted markdown table
-   **Content**:
    -   Overall means and SDs for all sleep variables
-   Statistics by 2-week block (for H2)
-   Missingness percentages
-   Outlier counts before/after cleaning
-   **Purpose**: Provide quantitative summary for reproducibility

## Advanced Visualizations

**7. Cross-Lagged Associations** (Hypothesis 1)

-   **Type**: Coefficient plot with error bars
-   **X-axis**: Lag structure (t, t-1, t-2)
-   **Y-axis**: Standardized regression coefficients
-   **Panels**: PA and NA as separate outcomes
-   **Purpose**: Display temporal precedence of sleep → mood effects

**8. Growth Trajectory Plot** (Hypothesis 2)

-   **Type**: Individual + group trajectory spaghetti plot

-   **X-axis**: Week postpartum

-   **Y-axis**: BDI score

-   **Lines**: Individual trajectories (thin, transparent) and group mean (thick, colored)

-   **Color gradient**: Mean sleep duration for each person

-   **Purpose**: Visualize H2a predictions (sleep × time interaction)
