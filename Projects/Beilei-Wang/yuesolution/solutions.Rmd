---
title: "yue_solution"
output: md_document
---

```{r knitr_opts, include = FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

# Summer Sports Experience: 2017 to 2021

## Topic

The goal of this project is to analyze and visualize the most popular sports among children aged 8 to 14 in different regions, focusing on weekend activity data collected in parks. The aim is to understand regional differences in children's participation in sports and to identify which sports are the most popular and frequently played by children.

## The Data Set

You can find the [file](https://catalog.data.gov/dataset/summer-sports-experience) here. It includes information on the duration and type of weekend sports activities in parks. In this project, we will utilize this data to identify the sports with the longest participation duration in each borough and analyze the regional variations in sport preferences.

## Visualization
This bar chart shows the total participation time for the most popular sport in each region.
```{r setup, message = FALSE}
library(ggplot2)
library(tidyverse)
library(readr)
```


```{r pressure,echo=FALSE}
# read file
data <- read.csv("Summer_Sports_Experience__2017_to_2021.csv")

# select needed
newdata <- data %>%
  select(Borough.Location, Sports.Played, Sunday.s.Attendance, Saturday.s.Attendance) %>%
  rename(
    Region = Borough.Location,
    Sport = Sports.Played,
    Sunday_Attendance = Sunday.s.Attendance,
    Saturday_Attendance = Saturday.s.Attendance
  ) %>% 
  #Calculate the sum
  mutate(
    Sunday_Attendance = as.numeric(Sunday_Attendance),
    Saturday_Attendance = as.numeric(Saturday_Attendance),
    weekends = Sunday_Attendance + Saturday_Attendance
  ) %>%
  group_by(Region, Sport) %>%
  summarize(total_weekends = sum(weekends), .groups = "drop")

# get every sport and make sure lower
cleandata <- newdata %>%
  separate_rows(Sport, sep = ",\\s*") %>%
  mutate(Sport = tolower(trimws(Sport)))

# top4 sports
top_4_sports <- cleandata %>%
  count(Sport, sort = TRUE) %>%
  slice_max(n, n = 4) %>%
  pull(Sport)

# get top4 data and delete empty data
top4_data <- cleandata %>%
  filter(Sport %in% top_4_sports, 
         !is.na(Region) & Region != "",
         total_weekends > 0)

#total time
region_totals <- top4_data %>%
  group_by(Region) %>%
  summarize(total_weekends = sum(total_weekends), .groups = "drop")

# convert the numbers into relative numbers
normalized_data <- top4_data %>%
  group_by(Region) %>%
  mutate(
    relative_weekends = total_weekends / sum(total_weekends)
  ) %>%
  ungroup()

# mapping
ggplot(normalized_data, aes(x = Region, y = relative_weekends, fill = Sport)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(
    title = "Most Popular Sports Across Regions",
    x = "Region",
    y = "Relative Participation Time",
    fill = "Sport"
  ) +
  scale_y_continuous(labels = scales::percent)  +
  # Add total attendance as labels on top of bars
  geom_text(
    data = region_totals, 
  #make the bars of equal height
    aes(x = Region, y = 1, label = scales::comma(total_weekends)),
    inherit.aes = FALSE,
    vjust = -0.5,  
    size = 4
  ) 


```

## Conclude 
Children in Queens get the most exercise on weekends, with soccer and basketball being the most popular among kids.