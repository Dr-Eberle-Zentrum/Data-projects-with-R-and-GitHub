---
title: "jungihong10"
author: "jungihong10"
output: md_document
---

This project analyzes participation trends in summer sports programs across different regions using the attendance data from 2017 to 2021. The goal is to identify the top four most popular sports based on participation time and visualize regional trends through stacked bar charts. By cleaning, transforming, and aggregating the data, the project provides insights into regional sports preferences and overall participation patterns.

```{r visualisation, echo=FALSE, message=FALSE, warning=FALSE}


# Load necessary libraries
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)  # For relative paths

# Load the dataset using a relative path
file_path <- "Summer_Sports_Experience__2017_to_2021.csv"
data <- read.csv(file_path)

# Step 1: Clean and split the sports data
split_sports_data <- data %>%
  mutate(Sports.Played = gsub("\\s+", ", ", Sports.Played)) %>%  # Replace multiple spaces with a comma and space
  separate_rows(Sports.Played, sep = ",\\s*") %>%  # Separate the sports based on commas
  mutate(
    Sports.Played = tolower(Sports.Played),  # Convert all sports to lowercase to handle case differences
    Attendance.Sum = as.numeric(Attendance.Sum)  # Ensure Attendance.Sum is numeric
  ) %>%
  filter(Attendance.Sum > 0, Sports.Played != "")  # Remove rows with Attendance.Sum = 0 or empty sports

# Step 2: Identify the top 4 most frequent sports
top_4_sports <- split_sports_data %>%
  count(Sports.Played, sort = TRUE) %>%
  slice_max(n, n = 4) %>%
  pull(Sports.Played)

# Step 3: Filter the dataset for the top 4 sports
filtered_data <- split_sports_data %>%
  filter(Sports.Played %in% top_4_sports)

# Step 4: Summarize total time spent on each sport by region for the top 4 sports
sport_summary <- filtered_data %>%
  group_by(Borough.Location, Sports.Played) %>%
  summarise(Total_Attendance = sum(Attendance.Sum, na.rm = TRUE), .groups = "drop") %>%
  arrange(desc(Total_Attendance))

# Step 5: Create the stacked bar chart for the top 4 sports by region
stacked_data <- sport_summary %>%
  mutate(Borough.Location = factor(Borough.Location, levels = c("Queens", "Bronx", "Brooklyn", "Staten Island", "Manhattan")))

# Calculate total attendance per region for labels
total_attendance_per_region <- stacked_data %>%
  group_by(Borough.Location) %>%
  summarise(Total_Attendance_All_Sports = sum(Total_Attendance))

# Plot the chart with total attendance labels
ggplot(stacked_data, aes(x = Borough.Location, y = Total_Attendance, fill = Sports.Played)) +
  geom_bar(stat = "identity", position = "stack") +
  geom_text(
    data = total_attendance_per_region,
    aes(x = Borough.Location, y = Total_Attendance_All_Sports, label = Total_Attendance_All_Sports),
    position = position_stack(vjust = 1.05),  # Place text above the stack
    inherit.aes = FALSE
  ) +
  labs(
    title = "Top 4 Most Popular Sports by Participation Time in Different Regions",
    x = "Region",
    y = "Total Participation Time (in hours)",
    fill = "Sport"
  ) +
  theme_minimal() +
  theme(
    legend.position = "bottom",
    axis.text.x = element_text(angle = 45, hjust = 1)
  )
```