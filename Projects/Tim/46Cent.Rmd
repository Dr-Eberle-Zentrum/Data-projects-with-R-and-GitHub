---
title: "46Cent"
author: "Gabriel Mancho"
date: "`r Sys.Date()`"
output: md_document
---

```{r misc}
library(tidyverse)
library(this.path)
```
 
# Reading the data
```{r}
setwd(this.path::this.dir())
daten <- read_delim("klimadaten_tuebingen.csv", delim = ";")

# Fixing the average temp. column
daten <- daten %>% 
  mutate(
    temperatur_mittelwert = gsub(",", ".", temperatur_mittelwert),
    temperatur_mittelwert = as.numeric(temperatur_mittelwert)
  )
```

# Wie veränderte sich die Temperatur im zeitlichen Verlauf?
```{r}
daten %>%
  filter(saison == "kalenderjahr") %>% 
  ggplot(
    aes(x = jahr, y = temperatur_mittelwert)
  )+
  geom_line(linewidth = 1)+
  labs(
    y = "Mittelwert (C°)",
    x = "Jahr",
    title = "Temperatur über die Jahre"
  )
```

# Wie verändert sich die Temperatur im Jahreszeitlichen Verlauf, über den gesamten Messzeitraum?
```{r}
daten %>%
  filter(c("winter_djf", "fruehjahr_mam", "sommer_jja", "herbst_son") == saison) %>% 
  ggplot(
    aes(x = jahr, y = temperatur_mittelwert, color = saison)
  )+
    geom_line(linewidth = 1)+
  labs(
      y = "Mittelwert (C°)",
      x = "Jahr",
      title = "Temperatur in den Jahreszeiten",
      color = "Jahreszeit",
  )
```

# Wie verhalten sich die Niederschlagsmengen in Kombination mit den Heißen Tagen?
```{r}
daten %>%
  filter(saison == "kalenderjahr") %>% 
  ggplot(
    aes(x = niederschlag_summe, y = temperatur_heisse_tage)
  )+
  geom_point()+
  labs(
    title = "Heiße Tage u. Niederschlagsmengen",
    x = "Niederschlagsumme (ml)",
    y = "Anzahl der heißen Tage (Jahr)"
  )
```

# Wie entwickeln sich die Heißtage und Frosttage im laufe der Zeit und Saisonal?
```{r}
daten %>%
  filter(saison == c("winter_djf", "fruehjahr_mam", "sommer_jja", "herbst_son")) %>%
  ggplot(
    aes(x = jahr, y = temperatur_heisse_tage, color = saison)
  )+
  geom_line(linewidth = 1)+
  labs(
    title = "Heisse Tage in den verschiedenen Jahreszeiten",
    y = "Anzahl heisser Tage",
    x = "Jahr",
    color = "Jahreszeit"
  )
```

```{r}
daten %>%
  filter(saison == c("winter_djf", "fruehjahr_mam", "sommer_jja", "herbst_son")) %>%
  ggplot(
    aes(x = jahr, y = temperatur_frosttage, color = saison)
  )+
  geom_line(linewidth = 1)+
  labs(
    title = "Frosttage in den verschiedenen Jahreszeiten",
    y = "Anzahl Frosttage",
    x = "Jahr",
    color = "Jahreszeit"
  )
```

```{r}
daten %>% 
  filter(saison == "kalenderjahr") %>%
  pivot_longer(cols = c(temperatur_heisse_tage, temperatur_frosttage),
               names_to = "Type",
               values_to = "Anzahl") %>% 
  ggplot(
    aes(x = jahr, y = Anzahl, color = Type)
  )+
  geom_line(linewidth = 1)+
  labs(
    title = "Frosttage / heisse Tage im Laufe der Jahre",
    color = "Art"
  )+
  scale_color_manual(
    values = c("temperatur_heisse_tage" = "red", 
               "temperatur_frosttage" = "blue"),
    labels = c("Frosttage", "Heisse Tage")
  )
```

# Saisonale Trenddiagramme, alle Saisons in einem Diagramm (2023)
```{r}
daten %>%
  filter(saison %in% c("winter_djf", "fruehjahr_mam", "sommer_jja", "herbst_son") & jahr == 2023) %>%
  ggplot(aes(x = saison, y = temperatur_mittelwert, fill = saison)) +
  geom_col()+
  labs(
    title = "Saisondurschnitte 2023",
    y = "Temperaturdurschnitt (C°)",
    x = "Jahreszeit",
    fill = "Jahreszeiten"
    
  )
```

# Wie häufig treten Trockenperioden auf und wie lange dauern diese an?
```{r}
daten %>% 
  filter(saison == "kalenderjahr") %>%
  mutate(periode_kategorie = cut(trockenperiode_tage_maximum,
                                 breaks = c(0, 10, 20, 30, 40, 100),
                                 labels = c("0-10", "11-20", "21-30", 
                                            "31-40", ">40"),
                                 right = TRUE)) %>%
  ggplot(
    aes(x = jahr, y = periode_kategorie, fill = trockenperiode_tage_maximum)
  )+
  geom_tile()+
  labs(
    title = "Konzentration der Trockenperioden über die Jahre",
    x = "Jahr",
    y = "Anzahl Trockentage / Jahr",
    fill = "Trockentage"
  )
```

```{r}
daten %>% 
  filter(saison == "kalenderjahr") %>% 
  ggplot(
    aes(x = jahr, y = trockenperiode_tage_maximum)
  )+
  geom_col()+
  labs(
    title = "Maximale Trockenperioden über die Jahre",
    x = "Jahr",
    y = "Längste Trockenperiode im Jahr"
  )
```

# Gibt es einen Zusammenhang zwischen Tropennächten und Trockentagen?
Es gibt keine Tropennächte ?

# Wie häufig gab es jährlich mehr als 5 Frosttage/Heißtage im Jahr?
```{r}
daten %>%
  filter(saison == "kalenderjahr") %>%
  select(temperatur_heisse_tage, temperatur_frosttage) %>%
  cor(use = "complete.obs") %>%
  as.data.frame() %>%
  rownames_to_column("var1") %>%
  pivot_longer(cols = -var1, names_to = "var2", values_to = "correlation") %>%
  ggplot(aes(x = var1, y = var2, fill = correlation)) +
  geom_tile(color = "white") +
  labs(title = "Korrelation zwischen heissen / Frosttagen") +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 14, face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    axis.title = element_blank()
  )
```

# Hat die Anzahl an Starknierderschlägen über die Jahre zugenommen?
```{r}
daten %>% 
  filter(saison == "kalenderjahr") %>% 
  ggplot(
    aes(x = jahr, y = starkniederschlag_20mm_tage)
  )+
  geom_line(linewidth = 1)+
  geom_hline(
    aes(yintercept = 4.33), linetype = "dotted", linewidth = 1, color = "red"
    )+
  labs(
    title = "Starkniederschläge über die Jahre",
    y = "Tage mit Starkniederschlägen im Jahr",
    x = "Jahr" 
  )
```

