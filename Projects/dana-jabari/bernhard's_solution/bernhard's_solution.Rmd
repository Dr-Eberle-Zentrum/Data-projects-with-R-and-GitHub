---
title: "R Notebook"
output: html_notebook
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(stringr)
library(tidyverse)
data_raw <- read.csv("https://raw.githubusercontent.com/Dr-Eberle-Zentrum/Advanced-data-processing-with-R/main/Projects/dana-jabari/cloze_task_results.csv")

data_raw |>
  mutate(keyword = factor(str_extract(text, "\\w+(?=\\,)"))) |> # extraction of the keyword
  mutate(response = str_to_title(response)) |> # make response uppercase
  filter(response != "") |> # remove empty responses
  distinct(keyword, .keep_all = T) |> # remove duplicated entries due to same response count
  group_by(keyword) |>
  filter(count == max(count)) |> # filter out the 'best alternatives'
  mutate(category = factor(case_when(
    count > 20  ~ 1,
    count > 14 & count <= 20 ~ 2,
    count > 10 & count <= 14 ~ 3,
    count <= 10 ~ 4
  ), levels = 1:4, labels = c(">20", ">14 and <= 20", ">10 and <= 14", "<= 10"))
  ) -> data 

# data$category = ""
# data[data$count > 20,]$category = ">20"
# data[data$count > 14 & data$count <= 20,]$category = ">14" 
# data[data$count > 10 & data$count <= 14,]$category = ">10"
# data[data$count <= 10,]$category = ">0" 
# data$category <- factor(data$category)

print(data)
```

```{r, echo=FALSE, fig.height = 6}

for (i in levels(data$category)) {
  print(
    data |>
    filter(category == i) |>
    mutate(keyword = fct_reorder(keyword, count, .desc = TRUE)) |>
    ggplot(aes(x = reorder(keyword, + count), y = count)) +
    geom_bar(stat = "identity", width = 0.8, fill = "wheat3", color = "black") +
    coord_flip() +
    geom_text(aes(y = 0, label = str_c(response, " ", count)), hjust = 0, nudge_y = 0.2) +
    ylim(0, 50) +
    labs(title = str_c("Keywords and their responses with count ", i)) +
    xlab("Keyword") +
    ylab("Count") +
    theme_classic()
  )
}

```
