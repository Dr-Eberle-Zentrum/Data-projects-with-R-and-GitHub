---
title: "project-description"
author: "Timo Walcher"
date: "`r Sys.Date()`"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "~/Family/Timo/Studium/Master/R2/Data-projects-with-R-and-GitHub")
options(repos = c(CRAN = "https://cran.r-project.org"))
install.packages("tidyverse")
library(tidyverse)
```

## About the Data
The dataset ([SoilData.csv](SoilData.csv)) contains information about soil. Soil samples where taken from soil profiles somewhere in the Naturpark Schönbuch and analysed in a laboratory. Each soil profile consists of several horizons (see below) and samples where taken from every horizon, so the rows represent the horizons of all the profiles. 
The data table comes as .csv file but was not managed well, which means there is some cleaning to do.

This is what a soil profile looks like
![soil profile](soilprofile.jpg)
As you can see, a profile can be differed into several horizons (O,A,B,C) as mentioned above. Here is a preview of the first few lines of the dataset: 
```{r, include=F}
SoilData <- read_delim("Projects/timow98/SoilData.csv", delim = ";", 
escape_double = FALSE, trim_ws = TRUE)
```

```{r, echo=F}
knitr::kable(
  SoilData[1:10, ], 
  caption = "Preview of the data table"
)
```

The first line contains the column names. The second line contains the units. But we can only have one header and we do not want the second line as it messes up the data type of the columns.

## Columns explained
- `Labornummer Tübingen`: individual sample number
- `Profil_2`: number of the profile
- `Horizont_43`: number of horizon (per profile)
example: as you see in the preview above, the profile number two was divided into 6 horizons and there was a sample taken from each of these horizons. This means, that if I want to compare profile, I will need to calculate the data from all its horizons
- `Tiefe_44`: accumulated depth of the horizons
- `Horizontbezeichnung_45`: type of horizon (each main horizon as shown above can be divided into subhorizonts like Ah and Al for example)
- `East_84`: Coordinates "Easting" in meters (UTM coordinates)
- `North_85`: Coordinates "Northing" in meters (UTM coordinates)
- `Neigung_16`: slope
- `Expozition_17`: direction (N, NE, ...)
- `Corg`: percentage of organic carbon
- `CaCO3`: percentage of carbonate
- `Ca`, `Mg`, `K`, `Na`: calcium, magnesium, potassium and sodium
- `Kationen`: cations
- `KAKpot`, `KAKpot2`: potential cation exchange capacity - same data but KAKpot2 has the decimal point at the wrong location
- `gS`, `mS`, `fS`, `S`: coarse, middle and fine fraction of sand - added together to Sand (S)
- `gU`, `mU`, `fU`, `U`: coarse, middle and fine fraction of silt - added together to silt (U)
- `gT`, `mT+fT`, `T`: coarse and middle + fine fraction of clay - added together to clay (T)
- `S+U+T`: all portions of grain sizes together (theoretically 100%)
- `Bodenart`: soil type according to Kartieranleitung 5 (sand, silt, clay)
Soil consists of the grain sizes Sand (S), Silt (U) and Clay (T). The three fractions can be divided into subcategories (coarse (g), middle (m), fine (f)). Knowing the proportions can tell us a lot about the soil. For example the fertility, water capacity and infiltration rate. Theoretically it adds up to 100% (column S+U+T) but in reality there might be some loss or it might even be more than 100% which is due to the laboratory method.

## What to do
### 1. The data needs some cleanup
  - the column KAKpot2 is not needed
  - the header displays numbers which do not make much sense. I would like to get rid of them by using rename_with() in combination with regular expressions.
  - Also, there is a second header with the respective units. Leaving this line will interfere with the datatype in R, that's why I want to delete this line and instead integrate the unit into the header such like this: Tiefe_[cm]
  - there is a typo in the column "Expozition". It should actually be "Exposition"
  - 99999 and 99999,99 are the NA values, but R does not know this, so all these values need to be set to NA. It should be noted that some of these NA values might be actual numbers, but some might also be of datatype character.
  - two columns need to be calculated: base_saturation_[%] by dividing "Kationen" by "KAKpot" and SOM_[%] by multiplying Corg with 1,72
  
### 2. Visualisation
1. I would like to aggregate (summarize) the columns Ca, Mg, K, Na and Kationen by profile number and visualize them with a stacked barplot like this (example): ![Stacked barplot](https://r-graph-gallery.com/48-grouped-barplot-with-ggplot2_files/figure-html/thecode4-1.png)
2. then I would like to have 3 piecharts of the "Ah" horizons of the profiles 82, 111 and 134 next to each other where I can see the portion of S (Sand), U (silt) and T (clay). See below:
  ![Sketch of piechart](sketch_1.jpg)
3. I would like to know where the profiles are. There are columns with coordinates which can be used to map the profiles. There are several packages for this, for example openstreetmap, mapview, ggplot2 and sf. [<span style="color:blue">This</span>](https://stackoverflow.com/questions/66827313/plotting-utm-coordinates) might be a good point to start. Depending on your way to do it you might need additional information:
Coordinate Reference System: UTM Zone 32 N WGS 84
EPSG: 25832
proj4string: "+proj=utm +zone=32 +datum=WGS84 +units=m +no_defs"