---
output: md_document
---

```{r, setup, include=FALSE}

knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

#The real MVP
library(tidyverse)

#For the excel file
library(readxl)

#For the sexy excel theme
library(ggthemes)
```

```{r read_n_pipe, echo=FALSE}

#Read in Data
data <- read_excel("data_smaschkon_2023-02-11_09-11.xlsx")

#A smaller but still holy pipe
data <- data %>%
  
  #Grab the cols we care about
  select("PS03_01",starts_with("SC01"), starts_with("TS01")) %>%
  
  #Change the no answer -9 value to NA
  mutate(
    across(1:ncol(.), na_if, -9)
    ) %>%
  
  #Kill the NA's. Could do this above in one mutate but this is readable af
  na.omit() %>%
  
  #Reverse the values in this col as 1 is low SC and this question should have 
  #had its scale reversed
  mutate(
    SC01_09 = 6 - SC01_09
  ) %>%
  
  #Calculate the row-wise means for each participant. x = SC and y = SU
  mutate(
    x = rowMeans(select(.,starts_with("SC01"))),
    y = rowMeans(select(.,starts_with("TS01")))
  )%>%
  
  #Change this col's values to text for ggplot to parse easily
  mutate( PS03_01 =
    case_when(
      PS03_01 == 1 ~ "Very Good",
      PS03_01 == 2 ~ "Pretty Good",
      PS03_01 == 3 ~ "Pretty Bad",
      PS03_01 == 4 ~ "Very Bad"
      )
    ) %>%
  
  #Grouped for plotting/hull calculations
  group_by(PS03_01)

  #Absolutely no idea how this works but it makes hull geometry appear
  hull <- data %>%
  slice(chull(x,y))
```

```{r plotting, echo=FALSE}

#Begin building plot, color = PS gives the groups
p1 <- ggplot(data, aes(x=x, y=y, color = PS03_01)) +
  
  #Points
  geom_point(size=2, shape = 18) +
  
  #Lin Regressions
  geom_smooth(method=lm, se=FALSE) +
  
  #Hulls
  geom_polygon(data = hull, alpha = .2, aes(fill = PS03_01, color = PS03_01)) +
  
  #Making the points have pretty colors
  scale_color_manual(values = c("#e6194B", "#42d4f4", "#3cb44b", "#911eb4")) +
  
  #Makes the hull have the same colors and eliminates extranious 
  #fill legend with guide = none
  scale_fill_manual(values = c("#e6194B", "#42d4f4", "#3cb44b", "#911eb4"), guide = "none") +
  
  #Janky way to get the ticks to read Low/High but it looks great with the 
  #excel theme
  scale_x_continuous(breaks=seq(2,4.5,.5),labels=c("Low SC","", "", "", "High SC", "")) +
  scale_y_continuous(breaks=seq(2,7,1),labels=c("Low SU","", "", "", "High SU", "")) +
  
  #Labels
  ggtitle("Self Control (SC) vs. Smartphone Usage (SU) \n Regarding Sleep Quality")+
  xlab("Self Control") +
  ylab("Smartphone Usage") +
  labs(color = "Sleep Quality") +
  
  #This forces the fill boxes in the legend to display these colors instead of 
  #the default gray. I believe this is needed due to the way aes() inheritance
  #works
  guides(color=guide_legend(override.aes=list(fill=c("#e6194B", "#42d4f4", "#3cb44b", "#911eb4")))) +
  
  #Sexy Excel Theme
  theme_excel_new()+
  
  #The plot title position = plot solved some scaling issues but works best
  #with default plots. ggthemes has some background stuff that interacts weirdly
  #with this as is.
  theme(
    plot.title = element_text(size=12),
    plot.title.position = "plot"
  )

#Save
ggsave(plot = p1, "SleepyTime.jpg")
```

##Original Implementation ![](SleepyTime.jpg)

```{r only_lines, echo=FALSE}
#Begin building plot, color = PS gives the groups
p2 <- ggplot(data, aes(x=x, y=y, color = PS03_01)) +
  
  #Points
  geom_point(size=2, shape = 18) +
  
  #Lin Regressions
  geom_smooth(method=lm, se=FALSE) +
  
  #Making the points have pretty colors
  scale_color_manual(values = c("#e6194B", "#42d4f4", "#3cb44b", "#911eb4")) +
  
  #Janky way to get the ticks to read Low/High but it looks great with the 
  #excel theme
  scale_x_continuous(breaks=seq(2,4.5,.5),labels=c("Low SC","", "", "", "High SC", "")) +
  scale_y_continuous(breaks=seq(2,7,1),labels=c("Low SU","", "", "", "High SU", "")) +
  
  #Labels
  ggtitle("Self Control (SC) vs. Smartphone Usage (SU) \n Regarding Sleep Quality")+
  xlab("Self Control") +
  ylab("Smartphone Usage") +
  labs(color = "Sleep Quality") +
  
  #Sexy Excel Theme
  theme_excel_new()+
  
  #The plot title position = plot solved some scaling issues but works best
  #with default plots. ggthemes has some background stuff that interacts weirdly
  #with this as is.
  theme(
    plot.title = element_text(size=12),
    plot.title.position = "plot"
  )

#Save
ggsave(plot = p2, "SleepyLines.jpg")
```

##Only Lines ![](SleepyLines.jpg)

```{r only_hulls, echo=FALSE}
#Begin building plot, color = PS gives the groups
p3 <- ggplot(data, aes(x=x, y=y, color = PS03_01)) +
  
  #Points
  geom_point(size=2, shape = 18) +
  
  #Hulls
  geom_polygon(data = hull, alpha = .2, aes(fill = PS03_01, color = PS03_01)) +
  
  #Making the points have pretty colors
  scale_color_manual(values = c("#e6194B", "#42d4f4", "#3cb44b", "#911eb4")) +
  
  #Makes the hull have the same colors and eliminates extranious 
  #fill legend with guide = none
  scale_fill_manual(values = c("#e6194B", "#42d4f4", "#3cb44b", "#911eb4"), guide = "none") +
  
  #Janky way to get the ticks to read Low/High but it looks great with the 
  #excel theme
  scale_x_continuous(breaks=seq(2,4.5,.5),labels=c("Low SC","", "", "", "High SC", "")) +
  scale_y_continuous(breaks=seq(2,7,1),labels=c("Low SU","", "", "", "High SU", "")) +
  
  #Labels
  ggtitle("Self Control (SC) vs. Smartphone Usage (SU) \n Regarding Sleep Quality")+
  xlab("Self Control") +
  ylab("Smartphone Usage") +
  labs(color = "Sleep Quality") +
  
  #This forces the fill boxes in the legend to display these colors instead of 
  #the default gray. I believe this is needed due to the way aes() inheritance
  #works
  guides(color=guide_legend(override.aes=list(fill=c("#e6194B", "#42d4f4", "#3cb44b", "#911eb4")))) +
  
  #Sexy Excel Theme
  theme_excel_new()+
  
  #The plot title position = plot solved some scaling issues but works best
  #with default plots. ggthemes has some background stuff that interacts weirdly
  #with this as is.
  theme(
    plot.title = element_text(size=12),
    plot.title.position = "plot"
  )

#Save
ggsave(plot = p3, "SleepyHulls.jpg")
```

##Only Hulls ![](SleepyHulls.jpg)
