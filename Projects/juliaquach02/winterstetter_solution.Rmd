---
title: "winterstetter_quach_solution"
author: "Winterstetter, Alexander"
date: "`r Sys.Date()`"
output: md_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(reshape2)
library(tidyr)
library(dplyr)
library(plyr)
```
## **Identifying dead cells**
________________________________________________________________________________

The project focused on identifying dying tumor cells in a treatment and a control group. In order to identify dying tumor cells, the criteria was applied that the intensity of the cell is below 40% of its initial intensity.
For each time point I calculated the relative intensity compared to the initial intensity. Based on this calculation I defined a Dummy Variable that indicates whether the cell is alive.
Please see an example of this approach below:

| Time Point | Cell.ID | Initial Intensity | Current Intensity | Relative Intensity | Alive |
|:---:|:---:|:---:|:---:|:---:|:---:|
| 0 | 0 | 100 | 100 | 1 | 1 |
| 1 | 0 | 100 | 75 | 0.75 | 1 |
| 2 | 0 | 100 | 60 | 0.6 | 1 |
| 3 | 0 | 100 | 35 | 0.35 | 0 |
| 4 | 0 | 100 | 25 | 0.25 | 0 |

```{r, include=FALSE}
setwd("~/01_Universit√§t/Advanced-data-processing-with-R/Projects/juliaquach02")
treated_cells <- read.csv("Tracks_Treated_Cells.csv")
treated_cells$group <- "treated"
untreated_cells <- read.csv("Tracks_Untreated_Cells.csv")
untreated_cells$group <- "untreated"

all_cells <- rbind(treated_cells, untreated_cells)

all_cells<- all_cells %>% group_by(Cell.ID) %>%
  dplyr::mutate(
    First_Value = dplyr::first(Intensity)) %>% dplyr::mutate(perc = Intensity/First_Value) %>%
  dplyr::mutate(above_40 = ifelse(Intensity/First_Value > 0.4, 1, 0)) %>% dplyr::mutate(current_alive = ifelse(above_40 == 1, 1, 0))

all_cells_mean <- all_cells %>% group_by(group, Cell.ID) %>% dplyr::summarize(rel_intensity_above_40 = mean(above_40))

all_cells_mean$total_alive <- ifelse(all_cells_mean$rel_intensity_above_40 == 1, 1, 0) 

all_cells <- merge(all_cells, all_cells_mean, by = c("Cell.ID", "group"))

df <- as.data.frame(table(all_cells_mean$group, all_cells_mean$total_alive))
df <- plyr::rename(df, c("Var1" = "Group", "Var2" = "Status"))
df
```


Afterwards I calculated the average value of this dummy variable. As soon as this variable was once 0 (at some point the cell died), the mean will also be below 1. Thus, I identified the cells that died in each repsective group.

You can see that in the *treatment group* only one cell (250) died at one point, while in the *control group* five cells died.
```{r, echo=FALSE}
knitr::kable(all_cells_mean |> arrange(total_alive) |> head())
```

## **Visualization of the population**
________________________________________________________________________________

```{r, echo=FALSE}
ggplot(df, aes(x = Group, y = Freq, fill = Status)) + geom_col(position = "stack") + labs(x = "Status (0 = Dead 1 = Alive)", y = "Count") +
  ggtitle("Status of cell in the treatment group") + theme_bw()
```
You can see that only a small amount of cells died completely die during the time of observation.


```{r, echo = FALSE}
all_cells_new <- all_cells %>% group_by(group, Time.point)  %>% dplyr::count(current_alive) %>% plyr::rename(c("n" = "no_alive")) %>%
  subset(current_alive == 1, select = c("group", "Time.point", "no_alive"))

all_cells_count <- all_cells %>% group_by(Time.point) %>% dplyr::count(group) %>% plyr::rename(c("n" = "no_group"))

all_cells_merge <- merge(all_cells_new, all_cells_count, by = c("group", "Time.point"))

all_cells_merge %>% group_by(group, Time.point) %>% mutate(rel_alive_group = no_alive/no_group) %>%
  ggplot(aes(x = Time.point, y = rel_alive_group, col = group)) + geom_line() + labs(x = "Point in time", y = "Relative amount of cells alive") + ylim(c(0.75,1)) + geom_hline(yintercept = 0.75, col = "red") + annotate("text", label = "75% of population alive", x = 2200, y = 0.76, col = "red") + theme_bw()
```

It is notable that the cells in the treatment group are nearly all the time all alive. In the untreated group there is a signficant drop in the relative amount of cells that are alive at the same time.
