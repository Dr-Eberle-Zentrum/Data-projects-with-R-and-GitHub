---
title: "winterstetter_quach_solution"
author: "Winterstetter, Alexander"
date: "`r Sys.Date()`"
output: md_document
---

```{r setup, include=FALSE}
library(ggplot2)
library(reshape2)
library(tidyr)
library(dplyr)
library(plyr)
```
## **Identifying dead cells**
________________________________________________________________________________

The project focused on identifying dying tumor cells in a treatment and a control group. In order to identify dying tumor cells, the criteria was applied that the intensity of the cell is below 40% of its initial intensity.
For each time point I calculated the relative intensity compared to the initial intensity. Based on this calculation I defined a Dummy Variable that indicates whether the cell is alive.
Please see an example of this approach below:

| Time Point | Cell.ID | Initial Intensity | Current Intensity | Relative Intensity | Alive |
|:---:|:---:|:---:|:---:|:---:|:---:|
| 0 | 0 | 100 | 100 | 1 | 1 |
| 1 | 0 | 100 | 75 | 0.75 | 1 |
| 2 | 0 | 100 | 60 | 0.6 | 1 |
| 3 | 0 | 100 | 35 | 0.35 | 0 |
| 4 | 0 | 100 | 25 | 0.25 | 0 |

```{r, include=FALSE}
setwd("~/01_Universit√§t/Advanced-data-processing-with-R/Projects/juliaquach02")
treated_cells <- read.csv("Tracks_Treated_Cells.csv")
untreated_cells <- read.csv("Tracks_Untreated_Cells.csv")

treated_cells<- treated_cells %>% group_by(Cell.ID) %>%
  dplyr::mutate(
    First_Value = dplyr::first(Intensity))

treated_cells$perc <- treated_cells$Intensity/treated_cells$First_Value
treated_cells$above_40 <- ifelse(treated_cells$Intensity/treated_cells$First_Value > 0.4, 1, 0)

treated_cells_mean <- treated_cells %>% group_by(Cell.ID) %>% dplyr::summarize(rel_intensity_above_40 = mean(above_40))

treated_cells_mean$alive <- ifelse(treated_cells_mean$rel_intensity_above_40 == 1, 1, 0) 

treated_cells <- merge(treated_cells, treated_cells_mean, by = "Cell.ID")

df_t <- as.data.frame(table(treated_cells_mean$alive))

untreated_cells <- untreated_cells %>% group_by(Cell.ID) %>%
  dplyr::mutate(
    First_Value = dplyr::first(Intensity))

untreated_cells$perc <- untreated_cells$Intensity/untreated_cells$First_Value
untreated_cells$above_40 <- ifelse(untreated_cells$Intensity/untreated_cells$First_Value > 0.4, 1, 0)

untreated_cells_mean <- untreated_cells %>% group_by(Cell.ID) %>% dplyr::summarize(rel_intensity_above_40 = mean(above_40))

untreated_cells_mean$alive <- ifelse(untreated_cells_mean$rel_intensity_above_40 == 1, 1, 0) 

untreated_cells <- merge(untreated_cells, untreated_cells_mean, by = "Cell.ID")

df_u <- as.data.frame(table(untreated_cells_mean$alive))
```


Afterwards I calculated the average value of this dummy variable. As soon as this variable was once 0 (at some point the cell died), the mean will also be below 1. Thus, I identified the cells that died in each repsective group.

You can see that in the *treatment group* only one cell (250) died at one point, while in the *control group* five cells died.
```{r, echo=FALSE}
treated_cells_mean |> arrange(alive) |> print(n = 10)
```

```{r,echo=FALSE}
untreated_cells_mean |> arrange(alive) |> print(n = 10)
```


## **Visualization of the population**
________________________________________________________________________________

```{r, echo=FALSE}
ggplot(df_t, aes(x = Var1, y = Freq)) + geom_col(position = "stack") + labs(x = "Status (0 = Dead 1 = Alive)", y = "Count") +
  ggtitle("Status of cell in the treatment group") + theme_bw()

ggplot(df_u, aes(x = Var1, y = Freq)) + geom_col(position = "stack") + labs(x = "Status (0 = Dead 1 = Alive)", y = "Count") +
  ggtitle("Status of cell in the control group") + theme_bw()
```
