---
title: "Project 2"
author: "janaelodie"
date: "2025-01-02"
output: md_document
---

# First draft of Dennis Project

This is my current progress on the project.

For now, I have used the **standard version** to count points (i.e., a maximum of 3 points per nation in each tier).

However, I would like to implement your suggestions with **"Optional Bonus Points"** and **"Optional Point Modifier"** because, as you can see, in the standard option, there are only three countries that received any points, and two of them even ended up with the same score.

```{r setup, echo = FALSE, warning = FALSE, message = FALSE}

library(tidyverse)
library(here)


data <- read_csv2(here("Projects", "shad-lad-flad", "wows_playerbase_data.CSV"), na = "-") %>% 
  select(Nation, Tier, Type, Battles, `Win rate`, `Avg. damage`) %>% 
  
  # Leerzeichen und Prozentzeichen entfernen
  mutate(
    Battles = as.integer(gsub("\\s+", "", Battles)),  
    `Win rate` = as.numeric(gsub("\\s+|%", "", `Win rate`)),  
    `Avg. damage` = as.integer(gsub("\\s+", "", `Avg. damage`)),
    Type = trimws(Type)
  ) %>% 
  
  # Filtern
  filter(Tier >= 3 & Tier < 11) %>%  # Nur Tier 3 bis 10
  filter(Type %in% c("Battleship", "Cruiser", "Destroyer")) %>% 
  filter(Battles > 200000) %>% 
  drop_na() %>% 
  
  group_by(Nation, Tier) %>% 
  filter(n_distinct(Type) >= 2) %>%  # Mindestens zwei verschiedene Typen erforderlich
  ungroup() %>% 
  
  # F端r jeden Typ innerhalb eines Tiers die Nation mit den meisten Battles ermitteln
  group_by(Tier, Type) %>%
  mutate(max_battles = max(Battles)) %>%
  ungroup() %>%
  
  # Markiere die Nationen mit den meisten Battles pro Type
  mutate(is_max_battles = if_else(Battles == max_battles, 1, 0)) %>%
  
  # Berechne die Punkte f端r jede Nation und jedes Tier
  group_by(Nation, Tier) %>%
  mutate(total_points = sum(is_max_battles)) %>%
  ungroup() %>%
  
  # summiere die total_points pro Nation und Tier
  group_by(Nation, Tier) %>%
  
  # Behalte nur eine Zeile pro Nation und Tier
  distinct(Nation, Tier, .keep_all = TRUE) %>%
  
  # Berechne total_points_sum f端r jede Nation (einmal pro Nation, nicht mehrfach)
  group_by(Nation) %>%
  mutate(total_points_sum = sum(total_points)) %>%
  ungroup() %>%
  
  # Definiere die Reihenfolge der Tiers als Faktor 
  mutate(Tier = factor(Tier, levels = 10:3))  # Reihenfolge von Tier 10 bis Tier 3

```

```{r visualization, echo = FALSE, warning = FALSE, message = FALSE}

ggplot(data, aes(x = reorder(Nation, total_points_sum), y = total_points, fill = factor(Tier))) +
  geom_bar(stat = "identity", position = "stack", color = "black") +  # Balken mit schwarzem Rand
  geom_text(aes(label = case_when(
    total_points == 0 ~ "",  # Wenn 0 Punkte, keinen Text anzeigen
    total_points == 1 ~ "1 point", 
    total_points == 2 ~ "2 points", 
    total_points == 3 ~ "3 points", 
    total_points == 4 ~ "4 points", 
    total_points == 5 ~ "5 points", 
    total_points == 6 ~ "6 points", 
    total_points == 7 ~ "7 points", 
    total_points == 8 ~ "8 points", 
    TRUE ~ as.character(total_points)
  )), position = position_stack(vjust = 0.5), color = "black", size = 3) +  # Text in Balken
  # Total Points Sum hinter die Balken schreiben
  geom_text(aes(
    x = reorder(Nation, total_points_sum),
    y = total_points_sum + 0.5,  # Position rechts von den Balken
    label = total_points_sum
  ), hjust = 0, color = "black", size = 4, fontface = "bold") + 
  labs(
    title = "Points per Nation",
    x = "Nation",
    y = "Points",
    fill = "Tier"
  ) +
  coord_flip() + 
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5),  # Titel zentrieren
    axis.text.y = element_text(angle = 0, hjust = 1), 
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_blank() 
  ) +  # Achsenbeschriftung horizontal ausrichten
  scale_fill_manual(values = c("#b0e0e6", "#a6b9f2", "#d8a1e0", "#f8a2d2", "#ffb3a6", "#ffcd6b", "#ffe28a", "#fff9b0")) +  # Manuelle Farbskala f端r Tiers
  scale_y_continuous(expand = expansion(mult = c(0, 0.2)),
                     breaks = seq(0, 100))

```

I haven't had any difficulties with the visualization so far. Contrary to your example visualization, I decided against labeling the tiers and instead added a gradual color scale, as I found it clearer. However, I can change it again if needed.
