---
title: "Project 2"
author: "janaelodie"
date: "2025-01-02"
output: md_document
---

# My solution of Dennis Project

```{r packete,  echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse)
library(here)
```

### 1: Tidying the Data

This is how it worked:

```{r setup normal für beide, warning = FALSE, message = FALSE}
data <- read_csv2(here("Projects", "shad-lad-flad", "wows_playerbase_data.CSV"), 
                  na = "-", trim_ws = T) %>% 
  select(Nation, Tier, Type, Battles) %>% 
  
  mutate(
    Battles = as.integer(gsub("\\s+", "", Battles)),
    Type = trimws(Type)
  ) %>% 
  
  filter(Tier >= 3 & Tier < 11) %>%  
  filter(Type %in% c("Battleship", "Cruiser", "Destroyer")) %>% 
  filter(Battles > 200000) %>% 
  drop_na() %>% 
  
  group_by(Nation, Tier) %>% 
  filter(n_distinct(Type) >= 2) %>%  
  ungroup() %>% 

  glimpse()
```

This is how it didn’t work:

```{r setup falsch für beide, warning = FALSE, message = FALSE}
data._. <- read_csv2(here("Projects", "shad-lad-flad", "wows_playerbase_data.CSV"),
                     na = "-", trim_ws = T) %>% 
  select(Nation, Tier, Type, Battles) %>% 
  
  # mutate(
  #   Battles = as.integer(gsub("\\s+", "", Battles)),
  #   Type = trimws(Type)
  # ) %>% 
  
  filter(Tier >= 3 & Tier < 11) %>%  
  filter(Type %in% c("Battleship", "Cruiser", "Destroyer")) %>% 
  filter(Battles > 200000) %>% 
  drop_na() %>% 
  
  group_by(Nation, Tier) %>% 
  filter(n_distinct(Type) >= 2) %>%  
  ungroup() %>% 

  glimpse()
```

### 2: Visualisation without point modifier

```{r visualization1, echo = FALSE, warning = FALSE, message = FALSE}
  
 data1 <- data %>%  group_by(Tier, Type) %>% 
  mutate(rank = rank(-Battles, ties.method = "min")) %>%  # Rang basierend auf Battles
  # filter(rank <= 3) %>%  # Nur die Top 3 für jeden Typ und Tier behalten
  mutate(points = case_when(
    rank == 1 ~ 1,  # 1. Platz: 3 Punkte
    rank == 2 ~ 0,  # 2. Platz: 2 Punkte
    rank == 3 ~ 0,   # 3. Platz: 1 Punkt
    TRUE ~ 0
  )) %>% 
  ungroup() %>% 
  
  # Punkte pro Nation und Tier summieren
  group_by(Nation, Tier) %>% 
  summarize(total_points = sum(points, na.rm = TRUE), .groups = "drop") %>% 
  
  # Gesamte Punkte für jede Nation berechnen
  group_by(Nation) %>% 
  mutate(total_points_sum = sum(total_points, na.rm = TRUE)) %>% 
  ungroup() %>% 

  # Definiere die Reihenfolge der Tiers als Faktor 
  mutate(Tier = factor(Tier, levels = 10:3)) %>% 
  mutate(
    total_label = if_else(total_points == 0,  "", 
                          if_else(total_points %in% c(1),  as.character(total_points), 
                                  str_c(total_points, " points"))))

ggplot(data1, aes(x = reorder(Nation, total_points_sum), y = total_points, fill = factor(Tier))) +
  geom_bar(stat = "identity", position = "stack", color = "black") +  # Balken mit schwarzem Rand
  geom_text(aes(label= total_label), 
            position = position_stack(vjust = 0.5), color = "black", size = 3)+

  # Total Points Sum hinter die Balken schreiben
  geom_text(aes(
    x = reorder(Nation, total_points_sum),
    y = total_points_sum + 0.5,  # Position rechts von den Balken
    label = total_points_sum
  ), hjust = 0, color = "black", size = 4, fontface = "bold") + 
  labs(
    title = "Points per Nation",
    subtitle = "without point-modifier", 
    x = "Nation",
    y = "Points",
    fill = "Tier"
  ) +
  coord_flip() + 
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5), 
    plot.subtitle = element_text(hjust = 0.5), 
    axis.text.y = element_text(angle = 0, hjust = 1), 
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_blank() 
  ) +  # Achsenbeschriftung horizontal ausrichten
  scale_fill_manual(values = c("#b0e0e6", "#a6b9f2", "#d8a1e0", "#f8a2d2", "#ffb3a6", "#ffcd6b", "#ffe28a", "#fff9b0")) +  # Manuelle Farbskala für Tiers
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)),
                     breaks = seq(0, 100, by = 5))



```

### 2: With optional point modifier

```{r visualization2, echo = FALSE, warning = FALSE, message = FALSE}
 
data2 <- data %>%   
  group_by(Tier, Type) %>% 
  mutate(rank = rank(-Battles, ties.method = "min")) %>%  # Rang basierend auf Battles
  # filter(rank <= 3) %>%  # Nur die Top 3 für jeden Typ und Tier behalten
  mutate(points = case_when(
    rank == 1 ~ 3,  # 1. Platz: 3 Punkte
    rank == 2 ~ 2,  # 2. Platz: 2 Punkte
    rank == 3 ~ 1,   # 3. Platz: 1 Punkt
    TRUE ~ 0
  )) %>% 
  ungroup() %>% 
  
  # Punkte pro Nation und Tier summieren
  group_by(Nation, Tier) %>% 
  summarize(total_points = sum(points, na.rm = TRUE), .groups = "drop") %>% 
  
  # Gesamte Punkte für jede Nation berechnen
  group_by(Nation) %>% 
  mutate(total_points_sum = sum(total_points, na.rm = TRUE)) %>% 
  ungroup() %>% 

  # Definiere die Reihenfolge der Tiers als Faktor 
  mutate(Tier = factor(Tier, levels = 10:3)) %>% 
  mutate(
    total_label = if_else(total_points == 0,  "", 
                          if_else(total_points %in% c(1, 2, 3, 4, 5),  as.character(total_points), 
                                  str_c(total_points, " points"))))

ggplot(data2, aes(x = reorder(Nation, total_points_sum), y = total_points, fill = factor(Tier))) +
  geom_bar(stat = "identity", position = "stack", color = "black") +  # Balken mit schwarzem Rand
  geom_text(aes(label= total_label), 
            position = position_stack(vjust = 0.5), color = "black", size = 3)+

  # Total Points Sum hinter die Balken schreiben
  geom_text(aes(
    x = reorder(Nation, total_points_sum),
    y = total_points_sum + 0.5,  # Position rechts von den Balken
    label = total_points_sum
  ), hjust = 0, color = "black", size = 4, fontface = "bold") + 
  labs(
    title = "Points per Nation",
    subtitle = "with point-modifier", 
    x = "Nation",
    y = "Points",
    fill = "Tier"
  ) +
  coord_flip() + 
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", hjust = 0.5), 
    plot.subtitle = element_text(hjust = 0.5), 
    axis.text.y = element_text(angle = 0, hjust = 1), 
    panel.grid.minor = element_blank(),
    panel.grid.major.y = element_blank() 
  ) +  # Achsenbeschriftung horizontal ausrichten
  scale_fill_manual(values = c("#b0e0e6", "#a6b9f2", "#d8a1e0", "#f8a2d2", "#ffb3a6", "#ffcd6b", "#ffe28a", "#fff9b0")) +  # Manuelle Farbskala für Tiers
  scale_y_continuous(expand = expansion(mult = c(0, 0.1)),
                     breaks = seq(0, 100, by = 5))


```

### How I assigned the points

```{r anschauung,  eval=FALSE, warning = FALSE, message = FALSE}
  # 1: Group by Tier and Type
  group_by(Tier, Type) %>% 
  # 1: Rank based on Battles
  mutate(rank = rank(-Battles, ties.method = "min")) %>%  
  # 2: Points based on Rank
  mutate(points = case_when(
    rank == 1 ~ 3,  # 1. Platz: 3 Punkte
    rank == 2 ~ 2,  # 2. Platz: 2 Punkte
    rank == 3 ~ 1,   # 3. Platz: 1 Punkt
    TRUE ~ 0
  )) %>% 
  ungroup() %>% 
```
