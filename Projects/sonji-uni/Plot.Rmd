---
title: "Plot"
author: "ManCao"
date: "2023-03-27"
output: md_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
```

## Sonja's project

```{r}
#Sonja's project

#packages
library(ggpubr)
library(tidyverse)
library(ggrepel)

# read data
dataRaw <- read.csv("I4S_workingMemory_2023-02-26.csv",header=TRUE,sep=';')

# set timestamp
dataRaw$timestamp<-dataRaw$timestamp/1000
dataRaw$timestamp<-as.POSIXlt(dataRaw$timestamp,origin="1970-01-01",tz = "GMT")

# remove all instructions and examples
data<- dataRaw %>% 
  select(-c(time_elapsed, trial_type)) %>%
  filter((between(trial_index, 88,147)) |between(trial_index, 15,74)|between(trial_index, 161,220))%>%
  mutate(timestamp = floor_date(as.POSIXct(timestamp, format = "%Y-%m-%d %H:%M:%S"),"30 mins"))

# n_back sub_dataframe
back_1<-data %>% 
  filter(trial_index >14 & trial_index<75)%>%
  group_by(SID)%>%
  mutate(same_stim= lag(stim,1),oneBack= stim==same_stim)%>%
  drop_na(oneBack)%>%
  mutate(correct=(oneBack&response==0)|(!oneBack&is.na(response)))%>%
  filter(rt != "null") |> 
  summarise(accuracy =mean(correct,na.rm=T),
            timezone=format(min(timestamp),'%H:%M'),
            rt=mean(as.numeric(rt))
            )%>%
  filter(!is.nan(rt)) |> 
  arrange(timezone)%>%
  mutate(type="1_back")

 back_2<- data %>% 
   filter(between(trial_index, 88,147))%>%
   group_by(SID)%>%
   mutate(same_stim= lag(stim,2),twoBack= stim==same_stim)%>%
   drop_na(twoBack)%>%
   mutate(correct=(twoBack&response==0)|(!twoBack&is.na(response)))%>%
   filter(rt != "null") |> 
   summarise(accuracy =mean(correct,na.rm=T),
             timezone=format(min(timestamp),'%H:%M'),
             rt=mean(as.numeric(rt))
   )%>%
   filter(!is.nan(rt)) |> 
   arrange(timezone)%>%
   mutate(type="2_back")
 
 back_3<- data %>% 
   filter(between(trial_index, 161,220))%>%
   group_by(SID)%>%
   mutate(same_stim= lag(stim,3),threeBack= stim==same_stim)%>%
   drop_na(threeBack)%>%
   mutate(correct=(threeBack&response==0)|(!threeBack&is.na(response)))%>%
   filter(rt != "null") |> 
   summarise(accuracy =mean(correct,na.rm=T),
             timezone=format(min(timestamp),'%H:%M'),
             rt=mean(as.numeric(rt))
   )%>%
   filter(!is.nan(rt)) |> 
   arrange(timezone)%>%
   mutate(type="3_back")

dataNew<-bind_rows(back_1,back_2,back_3)

# Plot efficiency against timestamp
p1<- 
ggplot(dataNew, aes(x=timezone, y=rt))+
  geom_boxplot()+
  labs(x = "Time of day", y = "Response Time (ms)", title = "How efficiency is affected by time")+
  facet_wrap(~type)+
  theme_bw()+
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_rect(fill = NA),
    axis.text.x = element_text(angle = 30, vjust = 0.5))

 print(p1)

# Plot accuracy against timestamp
p2<-
ggplot(dataNew, aes(x=timezone, y=accuracy))+
  geom_boxplot()+
  labs(x = "Time of day", y = "Response Time (ms)", title = "How accuracy is affected by time")+
  facet_wrap(~type)+
  scale_y_continuous(label=scales::percent)+
  theme_bw()+
  theme(
    panel.border = element_blank(),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    panel.background = element_rect(fill = NA),
    axis.text.x = element_text(angle = 30, vjust = 0.5))
  
print(p2)
```

