---
title: "Solution of UFC Statistics from Gabriel"
output: html_document
---

# Solution of UFC Statistics from Gabriel

```{r setup, include = FALSE}
library(tidyverse)
library(ggplot2)
```

## Data Import

```{r dataimport}
ufcevents <- readr::read_csv("Events.csv")
ufcfightersstat <- readr::read_csv("Fighters stats.csv")
ufcfighters <- readr::read_csv("fighters.csv")
ufcfights <- readr::read_csv("Fights.csv")
```

## Data Manipulation and Visualization

It is structure graph centered, so manipulation and plotting are in the same chunk.

### First Visualization:

```{r wlratio}
# hier haben wir das wlratio berechnet
ufcfigtherswl <- ufcfightersstat %>%
  mutate(wlratio = W / (W + L) ) %>%
  group_by(Weight_Class) %>%
  summarise(mean_wlratio = mean(wlratio, na.rm = TRUE))
# hier haben wir den jeweils st채rksten rausgefiltert:
ufc_top_per_class <- ufcfightersstat %>%
  mutate(wlratio = W / (W + L)) %>%
  group_by(Weight_Class) %>%
  slice_max(wlratio, n = 1, with_ties = FALSE)
# Zusammenf체hren der Tabellen:
ufc_combined <- ufc_top_per_class %>%
  select(Weight_Class, Fighter = `Full Name`, fighter_wlratio = wlratio) %>%
  left_join(ufcfigtherswl, by = "Weight_Class") %>%
  filter(!Weight_Class%in% c("Women's Bantamweight",
                             "Women's Featherweight",
                             "Women's Flyweight",
                             "Women's Strawweight"))
# Daten in long format:
plotdata <- ufc_combined %>%
  pivot_longer(cols = c(fighter_wlratio, mean_wlratio),
               names_to = "Type",
               values_to = "Value") %>%
  mutate(Type = recode(Type,
                       "fighter_wlratio" = "Top Fighter",
                       "mean_wlratio" = "Class Mean"))

ggplot(plotdata, aes(x = Weight_Class, y = Value, fill = Type))+
  geom_col(position = position_dodge())+
  labs(
    title = "W/L Ratio: Top Fighter vs. Class Mean",
    x = "Weight Class",
    y = "W/L Ratio",
  fill = ""
  )+
  theme_minimal()+
  theme(axis.text = element_text(angle = 45, hjust = 1))

ggsave("tobivis1.png", path = "./plots", width = 600, height = 400, units = ("px"), dpi = 300)
```


### Second Visualization:

```{r graph2, warning = FALSE}
ufcfigthershtoreach <- ufcfighters %>%
  mutate(
    heighttoreach = Ht. / Reach, na.rm = TRUE
  ) %>%
  mutate(
    wlratio = W / (W+L)
  )
  

ggplot(ufcfigthershtoreach,aes(x = heighttoreach, y = wlratio))+
  geom_point()+
  geom_smooth()+
  labs(
    title = "Longer arms don't necessarily help figthers to win",
    caption = "Ploting by Tobias Tuchel. Data from UFC",
    x = "Win / Loose Ratio",
    y = "Height to reach Ratio"
  )

ggsave("tobivis2.png", path = "./plots", width = 600, height = 400, units = ("px"), dpi = 300)
```

### Third Graph

```{r thirdgraph}
ufccountry <- ufcevents %>%
  separate(Location,
           into = c("City", "State", "Country"),
           sep = ",\\s*",
           fill = "left",
           extra = "merge")

ufccountrygroups <- ufccountry %>%
  group_by(Country) %>%
  summarise(n = n()) %>%
  arrange(desc(n)) 

library(maps)

# Geometriedaten:
world <- map_data("world")
# Joining:
events_world_map <- world %>%
  left_join(ufccountrygroups, by = c("region" = "Country"))
# Plotten:
ggplot(events_world_map, aes(x= long, y = lat, group = group, fill = n))+
  geom_polygon(color = "black")+
  scale_fill_continuous(name = "Number of Events", na.value = "white")+
  theme_minimal()+
  labs(title = "Most UFC events in US")

ggsave("tobivis3.png", path = "./plots", width = 600, height = 400, units = ("px"), dpi = 300)

```

### Fourth Graph

Problem: Spaltennamen sind nicht vergeben, aus den Abk체rzungen werde ich nicht schlau, Feedback ist gegeben. Der jetzige Graph macht so n채mlich keinen Sinn.
```{r fourthgraph}

ufcmethod <- ufcfights %>%
  group_by(Method) %>%
  summarise(n = n()) %>%
  arrange(desc(n))

graph <- ufcmethod %>%
  filter(Method %in% c("KO/TKO Punch", "KO/TKO Punches", "Submission",
                       "Doctor Stoppage", "Decision", "Draw", "Disqualification")) %>%
  ggplot(aes(x = reorder(Method, n), y = n)) +
  geom_col(fill = "blue") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x = "Method",
       y = "Number",
       title = "Most Knock-outs in UFC through ")
print(graph)

ggsave("tobivis4.png", path = "./plots", width = 600, height = 400, units = ("px"), dpi = 300)
```

### Fifth Graph

```{r graphfive}

ufcyearlydata <- ufcevents %>%
  mutate(year = year(Date)) %>%
  group_by(year) %>%
  summarise(n = n()) %>%
  arrange(desc(n))

ggplot(ufcyearlydata, aes(x = year, y = n))+
  geom_line(color = "blue")+
  labs(x = "Number of events",
       y = "year",
       title = "Sharp increase in UFC events till Pandemic")+
  theme_minimal()

ggsave("tobivis5.png", path = "./plots", width = 600, height = 400, units = ("px"), dpi = 300)

```



