---
title: "Graphics for Communication"
output:
  pdf_document: default
  html_document: default
---

```{r}
library(tidyverse)
```

Label:

```{r plot1}
ggplot(mpg, aes(displ, hwy))+
  geom_point(aes(color = class))+
  geom_smooth(se = FALSE)+
  labs(title = "Fuel efficiency general decreases with engine size")
```

Der Title sollte die **Kernaussage zusammenfassen** und nicht nur beschreibend sein.

Mehr Text geht bspw. mit subtitle und caption:

```{r plot2}
ggplot(mpg, aes(displ, hwy))+
  geom_point(aes(color = class))+
  geom_smooth(se = FALSE)+
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters are an exception because of their light weight",
    caption = "Plot: Tobias Tuchel, Data: R",
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    color = "Car type")
```

It`s possible to use mathematical equations instead of text strings. mit " out for quote() 

```{r plot3}
df <- tibble(
  x = runif(10),
  y = runif(10)
)

ggplot(df, aes(x, y))+
  geom_point()+
  labs( 
    x = quote(sum(x[i]^2, i == 1, n)),
    y = quote(alpha + beta + frac(delta, theta))
    )
```

Wir machen den Plot, der die Treibstoffeffizienz mit der Maschinengröße vergleicht einfach nochmal. Dieses mal werden wir jedoch die kleinen Sportwagen rausnehmen, da Sie die Trendkurve ungewünscht verfälschen.

```{r plot4}
mpg2 <- mpg %>%
  filter(class != "2seater")
ggplot(mpg2, aes(x = displ, y = hwy))+
  geom_point(aes(color = class))+
  geom_smooth(se = FALSE)+
  labs(
    x = "Engine Displacement (L)",
    y = "Highway fuel economy (mpg)",
    title = "Fuel efficency general decreases with engine size",
    subtitle = "",
    caption = "Plot: Tobias Tuchel Data: R"
  )
```

Man kann auch einzelnen Datenpunkte mit Text direkt im Plot beschreiben lassen mit geom_text(). Dafür kann man eigene Vektoren nur mit dem label erstellen und dann mit dem Datensatz für den Plot kombinieren:

```{r plot5}
best_in_class <- mpg %>%
  group_by(class) %>%
  filter(row_number(desc(hwy)) == 1)
```

Wir haben nun aus jeder Automobilklasse nur jeweils das Effizienteste ausgewählt.

```{r plot6}
ggplot(mpg, aes(x = displ, y= hwy))+
  geom_point(aes(color = class))+
  geom_text(aes(label = model), data = best_in_class)
```

Schwierig zu lesen, da sich die labels gegenseitig überdecken. Außerdem sind sie alle klein geschrieben. Mit geom_label() wird das schon ein wenig besser, weil es ein Rechteck um das Wort zieht. Mit nudge_y kann man die Beschriftung über den Punkt heben:

```{r plot6}
ggplot(mpg, aes(x = displ, y = hwy))+
  geom_point(aes(color = class))+
  geom_label(aes(label = model), data = best_in_class, alpha = 2, 
             nudge_y = 2)
```

Mit ggrepel kann man die Überschneidung automatisch reduzieren.

```{r plot7}
ggplot(mpg,aes(displ, hwy))+
  geom_point(aes(color = class))+
  geom_point(size = 3, shape = 1, data = best_in_class)+
  ggrepel::geom_label_repel(aes(label = model), data = best_in_class)
```

Schon mal ein Schritt in die richtige Richtung. Um die Lesbarkeit zu steigern, ist bspw. die beschrifteten Punkt deutlicher hervorzuheben und die Legende zu entfernen:

```{r plot8}
class_avg <- mpg %>%
  group_by(class) %>%
  summarise(
    displ = median(displ),
    hwy = median(hwy)
  )

ggplot(mpg, aes(displ, hwy, colour = class)) +
  ggrepel::geom_label_repel(aes(label = class),
    data = class_avg,
    size = 6,
    label.size = 0,
    segment.color = NA
  ) +
  geom_point() +
  theme(legend.position = "none")
```

Wenn wir jetzt nur ein Label habe wollen, und zwar bspw. in der oberen Ecken, dann machen wir dafür einen eigenen Datensatz:

```{r plot9}
label <- mpg %>%
  summarise(
    displ = max(displ),
    hwy = max(hwy),
    label = "Increasing engine size is \nrelated to lower fuel efficiency"
  )

ggplot(mpg, aes(displ, hwy))+
  geom_point()+
  geom_text(aes(label = label), data = label, vjust = "top", hjust = "right")
```


Mit vjust = top, bottom, center und hjust = left, right, center lässt sich der Text an 9 beliebigen Stellen positionieren. Soll er genau an der Kante sein, dann hilft -inf oder inf:

```{r plot10}
label = tibble(
  displ = Inf,
  hwy = Inf,
  label = "Increasing engine size is \nrelated to decreasing fuel efficiency"
)
ggplot(mpg, aes(displ, hwy))+
  geom_point()+
  geom_text(aes(label = label), data = label, vjust = "top", hjust = "right")
```

Innerhalb der Definition des tibbles muss = verwendet werden statt <-, da es nicht darum geht globale Variablen zu definieren, sondern Spalten innerhalb des Tibbles. Eine neue Zeile wurde manuell mit \n erzeugt, das lässt sich jedoch auch automatisieren mit stringr::str_wrap()

```{r neuzeile}
"Increasing engine size is related to decreasing fuel efficiency" %>%
stringr::str_wrap(width = 40) %>%
  writeLines()
```

------------------------------
## Exercises ##

### 1.

```{r ex01}
text <- tibble(
  displ = Inf,
  hwy = Inf,
  label = "H. C."
)

ggplot(mpg, aes(displ, hwy))+
  geom_point()+
  geom_text(aes(label = label), data = text, 
            vjust = "bottom", hjust = "left")+
  geom_text(aes(label = label), data = text,
            vjust = "top", hjust = "left")+
  geom_text(aes(label = label), data = text,
            vjust = "top", hjust = "right")+
  geom_text(aes(label = label), data = text,
            vjust = "bottom", hjust = "right")
```

Der Lösungsansatz, naja funktioniert wohl nicht ganz. Mit Inf wird der label in die obere linke Ecke gesetzt, was man danach schreibt wird ignoriert.
Lösung: in der tibble schon alle Positionen definieren:

```{r ex01solution}
label2 <- tribble(
 ~displ, ~hwy, ~label, ~vjust, ~hjust,
 Inf, Inf, "Shorti", "top", "right",
 -Inf, Inf, "H. C.", "top", "left",
 Inf, -Inf, "Vokaki", "bottom", "right",
 -Inf, -Inf, "K H G", "bottom", "left"
)

ggplot(mpg, aes(displ, hwy))+
  geom_point()+
  geom_text(aes(label = label, vjust = vjust, hjust = hjust), data = label2)
```
### Exercise 2

annotate() kann Text zu einem Plot hinzufügen, jedoch einen dataframe zu erstellen. Annotate besteht lediglich aus Vektoren.
Die zentrale Funktion ist:

annotate(
"geom", = Name des geoms 
x = Null, -> der ganze Quatsch dient zur Positionierung, mindestens eins ausfüllen
y = Null,
xmin = Null,
xmax, 
ymin, 
ymax, 
na.rm = FALSE -> fehlende Werte werden mit Warnung entfernt
)
annotate geht nur für text


```{r annotateexmaples}

plot <- ggplot(mpg, aes(displ, hwy))+
  geom_point(aes(color = class))

plot + annotate("text", x = 5:10, y = 40, label = "HC")
plot + annotate("rect", xmin = 7, xmax = 14, ymin = 7, ymax = 7, alpha = 0.2)
```


